(()=>{"use strict";function e(e,t){document.getElementById(e).addEventListener("click",t)}function t(e,t){document.getElementById(e).innerText=t}function s(e,t){document.getElementById(e).classList.add(t)}function i(e,t){document.getElementById(e).classList.remove(t)}function n(){return navigator.userAgentData?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((e=>navigator.userAgent.match(e)))}function a(e){"button-play"===e&&(s("button-pause","hidden"),["button-play","button-restart","show-settings","show-menu","show-stats"].forEach((e=>{i(e,"hidden")}))),"button-pause"===e&&(i("button-pause","hidden"),["button-play","button-restart","show-settings","show-menu","show-stats"].forEach((e=>{s(e,"hidden")})))}function o(e){const t=`${e}-modal`;document.getElementById(t).classList.add("hidden"),document.getElementById("modal-background").classList.add("hidden")}function l(e="loading..."){document.getElementById("loading-text").innerHTML=e,document.getElementById("loading").classList.remove("hidden"),d(0)}function r(){document.getElementById("loading").classList.add("hidden")}function d(e){document.getElementById("loading-bar-inner").style.width=`${e}%`}function h(e){document.getElementById("loading-text").innerHTML=e}function c(e,t){e.notes.forEach((t=>{t.tail&&t.tail.note.remove(),t.killed=!0,t.note.remove(),e.notes.delete(t)})),t.resetData(),["smudge-left","smudge-a","smudge-b","smudge-right"].forEach((e=>{document.getElementById(e).classList.remove("smudge-active")}))}function m(){const e=document.getElementById("calibrate-popup");e.style.top="5%",e.style.left="15%",e.style.width="60%",e.style.zIndex=10,e.style.opacity=1,e.classList.remove("hidden"),document.getElementById("calibrate-curtain").classList.remove("hidden")}function u(e){return new Promise((e=>{e()}))}function g(){return new Promise((e=>{e(A)}))}const A={level:1,slides:3,algorithm:"A",lastMessage:0,queryStats:!0,queryInitial:!0,progress:{l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}},stations:{kingFM:{name:"classical king FM",stream:"https://classicalking.streamguys1.com/king-fm-aac-128k"},mvn925:{name:"movin' 92.5",stream:"https://23093.live.streamtheworld.com/KQMVFM.mp3?dist=hubbard&source=hubbard-web&ttag=web&gdpr=0"},unsung80s:{name:"Unsung 80s",stream:"https://unsung80s.out.airtime.pro/unsung80s_a"},beat90s:{name:"The beat",stream:"https://ice10.securenetsystems.net/AM1380?playSessionID=1C5D8230-00FD-2EFE-2AEE4302B829B5F3"},"100hitz":{name:"100 hitz",stream:"https://pureplay.cdnstream1.com/6045_128.mp3"},mlelive:{name:"MLE live",stream:"https://listen.radioking.com/radio/114610/stream/462118"},chetFM:{name:"93.5 Chet FM",stream:"https://ice23.securenetsystems.net/KDJF?playSessionID=1CE4C155-F05D-ADFF-15CD1D9351B467C0"},scooter:{name:"Scooterist radio",stream:"https://listen.radioking.com/radio/214267/stream/257398?1709875088135"},"1234gr":{name:"1234 GR",stream:"https://radio1234gr.radioca.st/live"},hawk:{name:"Hawk classic rock",stream:"https://ice6.securenetsystems.net/KRSE?playSessionID=1D6EEF83-C785-2F70-5A76B4CD63C85056"}}},y=["NICE!","YEAH!","OH<br>YEAH!","YOU<br>ROCK!","ROCK<br>STAR!","BEAT<br>BURNER","SUPER<br>hexagon","SHRED!","WOO!","NICE<br>ONE!","YOU<br>GO!","BURNIN'<br>UP!","AWESOME!","SKILZ!"],f=document.getElementById("skilz-channel"),p=document.getElementById("skilz-meter"),I=document.getElementById("perfect"),B=document.getElementById("perfect-container"),v=document.getElementById("skilz-ball");function E(e,t,s){let i=1*e/(e+t),n=Math.floor(100*i);n<2&&(n=2),n>98&&e>10?(n=100,f.classList.add("skilz-channel-lit"),p.classList.add("skilz-meter-lit"),s.animations&&(I.classList.remove("hidden"),s.streak<226&&B.classList.add("perfect-slide-left"),150===s.streak&&(I.classList.add("hidden"),B.classList.remove("perfect-slide-left"),setTimeout((()=>{I.innerHTML=y[Math.floor(y.length*Math.random())],I.classList.remove("hidden"),B.classList.add("perfect-slide-left")}),50)),225===s.streak&&(I.classList.add("hidden"),B.classList.remove("perfect-slide-left"),setTimeout((()=>{I.innerHTML="ON<br>FIRE",I.classList.remove("perfect"),I.classList.add("perfect-stay"),I.classList.remove("hidden"),B.classList.add("perfect-slide-only")}),0)))):(f.classList.remove("skilz-channel-lit"),p.classList.remove("skilz-meter-lit"),I.innerHTML="perfect",I.classList.add("hidden"),I.classList.add("perfect"),B.classList.remove("perfect-slide-left"),B.classList.remove("perfect-slide-only")),v.style.top=100-n+"%"}function b(e,t,s,i,n,a,o,l,r,d,h,c,m){const u=1*h.masterInfo.songDelay-2e3,g=1*m/u*d;if(s.forEach((e=>{const t=i[e];if(t){const s=t.position+g;t.position=s;const n=t.height-g;if(n<0){t.note.remove(),i[e]=null;const s=document.getElementById(`${e}-flash-sustain`);s&&(s.classList.add("light-off"),setTimeout((()=>{s.remove()}),500))}t.note.style.height=`${n}px`,t.height=n}})),h.masterInfo.sliderPos>1e4){let e="a-",t="b-";"b-slider"===h.currentSlider&&(e="b-",t="a-"),["slide-left","slide-a","slide-b","slide-right"].forEach((s=>{document.getElementById(s).id=`${e}${s}`,document.getElementById(`${t}${s}`).id=s}));const s="a-slider"===h.currentSlider?"a-slider":"b-slider";h.currentSlider="a-slider"===h.currentSlider?"b-slider":"a-slider",h.movingBothSliders=!0,h.oldSliderPos=h.masterInfo.sliderPos,setTimeout((()=>{h.movingBothSliders=!1,h.oldSliderPos=0,document.getElementById(s).style.top="0px"}),1.5*u),h.masterInfo.sliderPos=0,h.slideStartTime=performance.now()}if(h.masterInfo.sliderPos+=g,h.movingBothSliders){const e="a-slider"===h.currentSlider?"b-slider":"a-slider";h.oldSliderPos+=g,document.getElementById(e).style.top=`${h.oldSliderPos}px`}document.getElementById(h.currentSlider).style.top=`${h.masterInfo.sliderPos}px`,h.oldSlider&&(h.oldSliderPosition+=g,h.oldSlider.style.top=`${h.oldSliderPosition}px`);for(const t of e){const s=t.position+g;if(t.position=s,t.tail){const e=t.tail.position+g;t.tail.position=e}if(!t.target&&s>a.top&&s<a.bottom){n[t.slideId].add(t),t.target=!0;const e={"slide-left":"smudge-left","slide-a":"smudge-a","slide-b":"smudge-b","slide-right":"smudge-right"}[t.slideId];document.getElementById(e).classList.add("smudge-active")}if(s>a.bottom&&!0===t.target){t.target=!1,n[t.slideId].delete(t),o();const e={"slide-left":"smudge-left","slide-a":"smudge-a","slide-b":"smudge-b","slide-right":"smudge-right"}[t.slideId];document.getElementById(e).classList.remove("smudge-active"),t.tail&&(t.tail.note.remove(),l[t.tail.slideId]=null)}s>r&&(t.killed=!0,t.note.remove(),e.delete(t))}}class L{constructor(e,t,s){this.selfDestruct=s,this.masterInfo=e,document.masterInfo=e,this.streamPlayer=t,document.streamPlayer=t,this.connection=new RTCPeerConnection,this.channel=this.connection.createDataChannel("channel"),this.channel.onopen=this.handleChannelStatusChange,this.channel.onclose=this.handleChannelStatusChange,this.streamId=0,this.nextSendMessage=0,this.nextReceiveMessage=0,document.getElementById("connect-stream-button").addEventListener("click",(()=>{T("attempting to connect");const e=document.getElementById("enter-stream-id").value;this.connect(e)})),document.getElementById("cancel-stream-button").addEventListener("click",(()=>{document.getElementById("stream-modal").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden")})),this.receiveChannel=null,this.connection.ondatachannel=this.receiveChannelCallback,this.connection.onicecandidate=e=>{if(e.candidate){console.log("sending candidate");const t={type:"candidate",candidate:e.candidate};this.sendMessage(JSON.stringify(t))}},this.connection.addEventListener("icegatheringstatechange",(e=>{console.log("ICE gathering state change: "+e.target.iceGatheringState)})),this.clipMode=!1}dealWithMessage(e){const t=JSON.parse(e);T("communication established"),"candidate"===t.type&&(console.log("received candidate"),this.connection.addIceCandidate(t.candidate)),"offer"===t.type&&(console.log("received offer"),this.connection.setRemoteDescription(t.offer).then((()=>{this.connection.createAnswer().then((e=>{this.connection.setLocalDescription(e).then((()=>{const t={type:"answer",answer:e};this.sendMessage(JSON.stringify(t))}))}))}))),"switch"===t.type&&(this.clipMode=!0,this.runClipMode())}connect(e){this.streamId=e;let t=0;const s=setInterval((()=>{this.clipMode&&clearInterval(s),this.getMessages(),t+=1,t>30?(clearInterval(s),T("could not connect"),this.closeConnection()):"open"===this.channel.readyState&&(T("connected to source"),setTimeout((()=>{T("listening for music")}),1e3),clearInterval(s))}),2e3)}getMessages(){const e=`${this.streamId}fromHost${this.nextReceiveMessage}`;var t;(t=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"retrieve",name:t})}).then((t=>{t.json().then((t=>{t.value?e(t.value):e(!1)}))}))}))).then((e=>{e&&(this.dealWithMessage(e),this.nextReceiveMessage+=1,this.getMessages())}))}sendMessage(e){const t=`${this.streamId}fromRemote${this.nextSendMessage}`;var s,i;s=t,i=e,new Promise((e=>{fetch("https://beatburner.com/api/",{method:"POST",body:JSON.stringify({action:"set",name:s,value:i})}).then((t=>{t.json(t).then((t=>{e(t)}))}))})),this.nextSendMessage+=1}handleChannelStatusChange(){this.channel&&("open"===this.channel.readyState?T("connected"):T("disconnected"))}receiveChannelCallback(e){this.receiveChannel=e.channel,this.receiveChannel.onmessage=e=>{!function(e){"test"===e.data?console.log("test message received"):"channel open"===e.data?(document.masterInfo.streaming=!0,document.getElementById("stream-status").innerText="connected",document.masterInfo.currentSong="streaming",document.getElementById("song-label").innerText="awaiting music",setTimeout((()=>{document.getElementById("song-label").innerText="keep your shirt on"}),3e3),o("stream"),document.masterInfo.streaming=!0):document.streamPlayer.setData(e.data)}(e)}}handleReceiveMessage(e){this.streamPlayer.setData(e.data)}closeConnection(){this.connection.close(),this.streamPlayer.stopStream(),document.getElementById("enter-stream-id").value="",T("not connected"),this.selfDestruct(),this.closed=!0,setTimeout((()=>{}),2e3)}runClipMode(){this.clipNum=0;const e=setInterval((()=>{this.closed&&clearInterval(e),fetch("https://beatburner.com/api/getClip.php",{method:"POST",body:JSON.stringify({clipId:`8248125clip${this.clipNum}`})}).then((e=>{e.json().then((e=>{if("success"===e.message){const t={str:e.clip,time:1e4,clipMode:!0};this.streamPlayer.setData(JSON.stringify(t)),this.clipNum+=1}else this.clipNum=0}))}))}),8e3)}}function T(e){document.getElementById("stream-status").innerText=e}const w={songDelay:4700,maxTailLength:500,targetBoundSizes:{top:.05,bottom:.05},mobile:{maxTailLength:1.2,travelLength:1.285,targetBounds:{top:.05,bottom:.05}},minNoteGap:150,allSlides:["slide-left","slide-a","slide-b","slide-right"]},k=[["blahBlahBlah","liveInMyHead","innerPeace","burningBayou","heyYou"],["lifeIBelieve","thinkingOfYou","rascalBack","hypeMeUp","paleCityGirl"],["indian","neverBackDown","womanWithTheWind","wayYouMove","moneyMoney"],["echoesOfThePast","aLifeLikeThis","neverBeBlue","schoolGirlCrush","temptation"],["handle","animal","myHeartIsAllYours","itDoesntMatter","rockItTonight"],["hotHotFire","safariSurf","heartBlueBlack","pilot","alongTheWay"],["myHeart"],["prettyThing","words","intoTheNight","inevitable","discoBeat","shareLove","getThatFeeling","aggressiveMetal","doItAgain","getaway","lifeIsGood","lollipop","longLostDream","monkeyBusiness","sinControl","turnItUp","unmistakable","veryEnd","wannaHaveFun"]],S={aggressiveMetal:"Lite Saturation",aLifeLikeThis:"River Lume",alongTheWay:"The Hunts",animal:"Title Holder",blahBlahBlah:"Camille de la Cruz",burningBayou:"Assaf Ayalon",cactusFlower:"Southern Call",discoBeat:'Clarx <a href="https://www.youtube.com/watch?v=_H5UO3c4YtM">NCS</a>',doItAgain:"Jay Putty",echoesOfRebellion:"R Harris",echoesOfThePast:"Max Hixon",edgeOfPossibility:"SPEARFISHER",emptyApartment:"Title Holder",getaway:"Add9Audio",getThatFeeling:"Ikoliks",godDamn:"Wheres LuLu",handle:"Van Stee",happierWithoutYou:"Jane and the Boy",heartBlueBlack:"Assaf Ayalon",heyYou:"ORKAS",hypeMeUp:"IamDayLight, Curtis Cole, Paper Plastic",hotHotFire:"MILANO",indian:"Taheda",inevitable:"Donnor & Tie",innerPeace:"Yotam Ben Horin",intoTheNight:"Brent Henderson",itDoesntMatter:"Title Holder",lifeIBelieve:"Jon Worthy and the Bends",lifeIsGood:"The Hunts",liveInMyHead:"Eldar Kedem",lollipop:"Captain Joz",longLostDream:"Sunriver",moneyMoney:"MILANO",monkeyBusiness:"Dizzy",myHeart:'Different Heaven & EH!DE <a href="https://www.youtube.com/watch?v=jK2aIUmmdP4">NCS</a>',myHeartIsAllYours:"Steven Beddall",neverBackDown:"Ben Goldstein feat. Moon",neverBeBlue:"Dan Zeitune",oneStep:"Ben Goldstein",overSpeedLimit:"HoliznaCCO",oweItToYou:"Gidon Schocken",paleCityGirl:"Indiana Bradley",pilot:"Supermans Feinde",prettyThing:"Crosstown Traffic",rascalBack:"Ben Bostick",risingStar:"TURPAK",rockItTonight:"MILANO",schoolGirlCrush:"Brunch with Bunny",safariSurf:"Ofer Koren",shareLove:"Buddha Kid",shouldBeMe:"Kyle Cox",sinControl:"Donner & Tie",stopTheWar:"Dan Ayalon",temptation:"Ride Free",thinkingOfYou:"SOURWAH",turnItUp:"Guesthouse",unmistakable:"Beo",wayYouMove:"Ben Wagner",veryEnd:"Nyron",whispersOfTheWreck:"R Harris",wannaHaveFun:"Flint",womanWithTheWind:"Ben Strawn",words:"Assaf Ayalon"},M={aggressiveMetal:"Aggressive Metal",aHumanBeing:"A Human Being",aLifeLikeThis:"A Life Like This",alongTheWay:"Along the Way",animal:"Animal",anthemOfRain:"Anthem of Rain",aThousandTimes:"A Thousand Times",bigWhiteLimousine:"Big White Limousine",blahBlahBlah:"Blah Blah Blah",burningBayou:"Burning on the Bayou",cactusFlower:"Cactus Flower",canvasOfDreams:"Canvas of Dreams",circusStory:"Russian Circus Story",cosmicCaravan:"Cosmic Caravan",cricket:"Cricket",discoBeat:"Disco",disfigure:"Disfigure",doItAgain:"Do It Again",echoesOfRebellion:"Echoes of Rebellion",echoesOfThePast:"Echoes of the Past",edgeOfPossibility:"Edge of Possibility",emptyApartment:"Empty Apartment",fightSong:"Israel Fight Song",findAWay:"Find a Way",fuckingTribute:"Mysticism of Your Fucking Sound",getaway:"Getaway",getThatFeeling:"Get That Feeling",glowOfTheMoon:"In the Glow of the Moon",godDamn:"God Damn",godOrDevil:"God or the Devil",handle:"Handle",happierWithoutYou:"Happier Without You",heartBlueBlack:"My Heart is Blue Black",heyYou:"Hey You",hotHotFire:"Hot Hot Fire",hypeMeUp:"Hype Me Up",indian:"Indian",inevitable:"Inevitable",innerPeace:"Inner Peace",intoTheNight:"Into the Night",itDoesntMatter:"It Doesn't Matter",keepYou:"Keep You",lifeIBelieve:"A Life I Believe",lifeIsGood:"Life is Good",littleGirl:"Little Girl",liveInMyHead:"Live In My Head",lollipop:"This Lollipop is Poppin",longLostDream:"Long Lost Dream",low:"Low",maniaMaster:"Mania Master",moneyMoney:"Money Money",monkeyBusiness:"Monkey Business",motherOfLife:"Mother of Life",myHeart:"My Heart",myHeartIsAllYours:"My Heart is All Yours",myLife:"It's My Life",needYourLove:"I Need Your Love",neverBackDown:"Never Back Down",neverBeBlue:"Never Be Blue",nowhere:"Nowhere",onAndOn:"On and On",oneStep:"One Step at a Time",oneSweetDream:"One Sweet Dream",overSpeedLimit:"50 Over the Speed Limit",oweItToYou:"I Owe it to You",paleCityGirl:"Pale City Girl",pilot:"Pilot",prettyThing:"Pretty Thing",rascalBack:"The Rascal is Back",risingStar:"Rising Star",rockItTonight:"Rock It Tonight",rockwell:"Rockwell",romeoAndJuliet:"Romeo and Juliet",safariSurf:"Safari Surf",satinDress:"Satin Dress",saturdaySpecial:"Saturday Special",schoolGirlCrush:"School Girl Crush",secretToSell:"Secret to Sell",sexualDeviant:"Pretty Tame Sexual Deviant",shareLove:"Share Love",shouldBeMe:"That Should Be Me",sinControl:"Sin Control",skyHigh:"Sky High",springRain:"Spring Rain",stickAroundYou:"Stick Around You",stopTheWar:"Stop the War",sunnyVibe:"Sunny Vibe",takeMe:"Take Me",temptation:"Temptation",timeOfMyLife:"Time of My Life",thinkingOfYou:"Thinking of You",turnItUp:"Turn It Up",ufo:"UFO",unbreakable:"Unbreakable",unmistakable:"Unmistakable",veryEnd:"Until the Very End",wayYouMove:"Way You Move",wannaHaveFun:"I Just Wanna Have Fun",whispersOfTheWreck:"Whispers of the Wreck",womanWithTheWind:"Woman with the Wind",words:"Words"},C={liveInMyHead:[5.037205,5.666201,6.685812,7.138018,8.14625,9.610683,10.570777,11.050061,12.673747,13.114142,13.505919,13.931016,14.345812,15.865932,16.987925,17.830851,19.361904,20.834093,21.354033,22.622167,22.978501,24.10614,25.730935,26.130904,26.490452,28.098648,30.048083,31.223818,31.673909,32.458421,33.628572,33.981033,35.580514,36.003429,36.843413,37.623115,38.353992,39.154532,39.906724,40.731389,41.938668,43.048111,44.203511,44.641982,45.045183,45.434014,47.466311,48.258488,49.339224,50.561943,51.419971,52.250051,53.581105,54.081967,54.474551,54.906022,55.348213,55.730907,56.780684,57.682358,58.514114,59.666784,60.090158,61.546353,62.027094,62.394442,62.786467,63.227355,64.778604,65.56243,66.002439,66.942519,67.370125,67.952085,69.185838,71.091405,72.610249,73.010495,74.218304,75.716191,76.210439,76.669088,77.403188,78.994336,79.953919,80.546598,80.962408,82.13301,82.954283,83.785888,84.610223,85.337987,86.110245,86.877962,87.185936,88.465958,89.282193,90.050274,90.802283,91.235262,92.402877,93.226746,94.786435,95.642206,96.946162,98.754287,99.466069,100.309997,101.102756,103.08516,104.277029,107.22849,107.798309,108.981045,109.373133,110.530307,110.945807,112.164525,112.57277,113.731036,114.498598,116.473889,117.221231,118.013956,118.858437,120.050131,120.83832,121.587868,122.395408,123.148521,123.563819,123.954463,124.378663,124.746271,125.986648,127.196037,129.502217,130.72506,134.178302,135.41911,136.643169,137.827352,140.543162,141.002191,142.986238,144.118269,144.899898,146.866811,147.75383,149.610327,150.409914,151.235234,153.578468,155.170067,157.545896,159.458616,160.677689,161.117829,161.874901,162.241957,162.658229,163.474682,164.265992,164.658672,165.066005,165.490879,165.874043,167.402521,167.802723,168.970747,169.410239,170.562007,170.954055,171.346319,171.733307,172.154242,172.537969,173.535127,174.491472,176.074923,176.918418,177.324759,177.724552,178.058203,178.457967,178.867726,179.8517,180.410145,181.549533,181.99426,182.780911,183.613689,184.010447,184.346028,185.557963,186.419883],blahBlahBlah:[1.9392,2.88299,4.03376,6.23524,7.3355,8.42612,11.69764,12.78881,14.98713,15.545432,16.082774,16.616753,17.116364,19.34521,20.410543,21.553405,22.09745,22.633528,23.163339,23.712601,26.481595,26.929944,27.481562,28.030378,28.602914,29.155633,30.265556,30.801524,31.336954,31.909952,32.423285,34.04894,34.616705,35.161882,35.705051,36.217268,36.74351,37.305936,37.841371,38.940791,39.513819,40.029427,41.122293,42.25777,43.386059,43.897444,44.457512,44.977555,45.537661,46.112765,46.585628,47.153328,47.681109,48.79491,49.32905,49.857103,50.432996,50.95405,51.521461,52.05155,52.657758,53.240764,53.813587,54.266471,54.736971,55.2974,55.817145,56.404824,56.977338,57.509029,58.077284,58.611594,59.188006,59.713884,60.224715,60.796333,61.312086,61.84924,62.377433,62.907417,64.056788,65.089579,66.266767,66.785177,67.330854,67.885156,68.418429,68.961184,69.457468,70.564559,71.15444,71.681584,72.232937,72.795824,73.348597,73.816774,74.432716,74.977067,75.49712,76.034013,78.243136,78.75392,79.305387,80.341215,80.982322,81.450086,82.520978,83.099796,83.674143,84.585264,85.286372,85.872959,86.457465,86.980575,87.510019,88.014019,88.961697,89.672991,90.203099,91.301429,91.841862,92.339715,93.284922,94.009406,95.681663,96.250128,96.777358,97.321038,97.785508,98.400829,99.001332,99.49875,100.034925,100.610104,101.136964,101.697481,102.233785,102.8012,103.336782,103.857582,104.434262,104.961294,105.497151,106.057717,106.58631,107.129607,107.424727,107.720816,108.216815,108.456635,108.761752,109.320545,109.885204,110.435432,110.969148,111.513796,111.811879,112.097384,112.601908,112.885029,113.15349,113.719831,114.249201,114.833104,115.329075,117.537189,119.737352,121.85827,122.426076,122.985567,123.562131,124.068039,126.25086,128.468248,130.615804,131.193325,131.777619,132.329471,132.825981,133.378177,133.651338,133.920804,134.477157,134.72712,135.032501,135.545546,136.057301,136.649681,137.174406,137.701333,138.001882,138.268279,138.811188,139.090799,139.362696,139.884909,140.41804,140.936991,141.509753,142.0572,142.594719,143.139911,143.689598,144.232913,144.798483,145.321111,145.832361,146.397356,146.963775,147.521268,148.057803,148.6168,149.125861,149.665919,150.203156,150.769054,151.082984,151.361965,151.867503,152.153365,152.434116,152.9456,153.500747,154.081969,154.593285,155.13715,155.441872,155.729185,156.218109,156.490876,156.793647,157.35345,157.886944,158.418005,158.920944,159.482229,159.769785,160.072728,160.553102,160.825605,161.147987,161.688852,162.251277,162.777548,163.315144,163.870083,164.146054,164.434815,164.969535,165.226015,165.496699,166.028494,166.564249,167.122133,167.680875]};function x(e){let t=0;return e.forEach((e=>{t+=e})),0===e.length?0:1*t/e.length}class P{constructor(e,t,s){this.masterInfo=e,l(),setTimeout((()=>{d(10)}),1e3),this.silentPlayer=new Audio(t),this.loudPlayer=new Audio(t),this.loudPlayer.addEventListener("ended",(()=>{a("button-play"),s(),this.restart()})),this.silentPlayer.addEventListener("ended",(()=>{"A"===this.currentRecorder?this.recorderA.stop():this.recorderB.stop(),this.ended=!0})),this.currentRecorder="A",this.startTimes={A:0,B:0},this.queue=[],this.chunks=[],this.paused=!1,this.ended=!1,this.timeToPlayLoud=this.masterInfo.songDelay;let i=!1;this.silentPlayer.oncanplaythrough=()=>{if(!i){i=!0;const e=new AudioContext,t=e.createMediaStreamDestination();e.createMediaElementSource(this.silentPlayer).connect(t),this.recorderInitial=new MediaRecorder(t.stream),this.recorderA=new MediaRecorder(t.stream),this.recorderB=new MediaRecorder(t.stream),this.recorderA.ondataavailable=e=>{this.chunks.push(e.data)},this.recorderB.ondataavailable=e=>{this.chunks.push(e.data)},this.recorderInitial.ondataavailable=e=>{this.chunks.push(e.data)},this.recorderA.onstop=()=>{const e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});for(;this.chunks.length>0;)this.chunks.shift();const t=new FileReader;t.onload=e=>{const t=btoa(e.target.result),s=new Audio(`data:audio/x-wav;base64,${t}`);s.addEventListener("ended",(()=>{this.playNextPiece()}));const i=new AudioContext,n=i.createMediaElementSource(s),a=i.createAnalyser();n.connect(a),i.setSinkId({type:"none"}),a.connect(i.destination),a.fftSize=4096;const o=new Uint8Array(a.frequencyBinCount);this.queue.push({audio:s,startTime:this.startTimes.A,endTime:this.silentPlayer.currentTime,analyser:a,dataArray:o,initial:!1})},t.readAsBinaryString(e)},this.recorderB.onstop=()=>{const e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});for(;this.chunks.length>0;)this.chunks.shift();const t=new FileReader;t.onload=e=>{const t=btoa(e.target.result),s=new Audio(`data:audio/x-wav;base64,${t}`);s.addEventListener("ended",(()=>{this.playNextPiece()}));const i=new AudioContext,n=i.createMediaElementSource(s),a=i.createAnalyser();n.connect(a),i.setSinkId({type:"none"}),a.connect(i.destination),a.fftSize=4096;const o=new Uint8Array(a.frequencyBinCount);this.queue.push({audio:s,startTime:this.startTimes.B,endTime:this.silentPlayer.currentTime,analyser:a,dataArray:o,initial:!1})},t.readAsBinaryString(e)},this.recorderInitial.onstop=()=>{const e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});for(;this.chunks.length>0;)this.chunks.shift();const t=new FileReader;t.onload=e=>{const t=btoa(e.target.result),s=new Audio(`data:audio/x-wav;base64,${t}`);s.addEventListener("ended",(()=>{this.playNextPiece()}));const i=new AudioContext,n=i.createMediaElementSource(s),a=i.createAnalyser();n.connect(a),i.setSinkId({type:"none"}),a.connect(i.destination),a.fftSize=4096;const o=new Uint8Array(a.frequencyBinCount);this.initialObj={audio:s,startTime:0,endTime:this.silentPlayer.currentTime,analyser:a,dataArray:o,initial:!0},this.queue.push(this.initialObj)},t.readAsBinaryString(e)},this.makeInitialRecording()}}}makeInitialRecording(){this.silentPlayer.currentTime=0,this.silentPlayer.play(),this.recorderInitial.start(),setTimeout((()=>{this.recorderInitial.stop(),this.silentPlayer.pause(),r(),this.currentRecorder="A",this.startTimes.A=this.silentPlayer.currentTime,document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden")}),1e4),[20,40,60,80,95].forEach((e=>{setTimeout((()=>{d(e)}),100*e)}))}switchRecorder(){let e=this.recorderA,t=this.recorderB;"B"===this.currentRecorder?(e=this.recorderB,t=this.recorderA,this.currentRecorder="A",this.startTimes.A=this.silentPlayer.currentTime):(this.currentRecorder="B",this.startTimes.B=this.silentPlayer.currentTime),t.start(),e.stop(),setTimeout((()=>{this.paused||this.ended||this.restarted||this.switchRecorder()}),4e3)}startRecording(e=!1){if(this.ended)return;let t=this.recorderA,s=this.startTimes.A;"B"===this.currentRecorder&&(t=this.recorderB,s=this.startTimes.B),e&&!this.ended?(this.startTimes.A=this.silentPlayer.currentTime,this.startTimes.B=this.silentPlayer.currentTime):this.silentPlayer.currentTime=s,this.silentPlayer.play(),t.start(),setTimeout((()=>{this.paused||this.ended||this.restarted||this.switchRecorder()}),4e3)}playNextPiece(){this.queue.shift(),this.queue.length>0&&!this.queue[0].initial&&(this.analyser=this.queue[0].analyser,this.dataArray=this.queue[0].dataArray,this.queue[0].audio.play())}playSoundOnDelay(){this.wait=setTimeout((()=>{this.loudPlayer.play(),this.playingLoud=!0}),this.timeToPlayLoud)}play(){this.restarted=!1,this.queue.length<1?console.log("queue empty"):this.paused?(this.startRecording(!0),this.playingLoud?this.loudPlayer.play():this.playSoundOnDelay(),this.playTime=performance.now(),this.analyser=this.queue[0].analyser,this.dataArray=this.queue[0].dataArray,this.queue[0].audio.play(),this.paused=!1):(this.playTime=performance.now(),this.playSoundOnDelay(),this.analyser=this.queue[0].analyser,this.dataArray=this.queue[0].dataArray,this.startRecording(),this.queue[0].audio.play(),this.countdown())}pause(){"A"===this.currentRecorder?(this.recorderA.stop(),this.currentRecorder="B"):(this.recorderB.stop(),this.currentRecorder="A"),this.silentPlayer.pause(),this.queue.length>0&&this.queue[0].audio.pause(),this.playingLoud?this.loudPlayer.pause():(this.timeToPlayLoud=this.masterInfo.songDelay-(performance.now()-this.playTime),clearTimeout(this.wait)),this.paused=!0,this.countdownCanceled=!0}restart(){for(this.restarted=!0,this.recorderA.stop(),this.recorderB.stop();this.queue.length>0;)this.queue.shift();for(this.queue.push(this.initialObj),this.initialObj.audio.currentTime=0,this.silentPlayer.currentTime=this.initialObj.endTime,this.currentRecorder="A",this.startTimes.A=this.initialObj.endTime,this.loudPlayer.currentTime=0,this.ended=!1,this.playingLoud=!1,this.paused=!1,this.timeToPlayLoud=this.masterInfo.songDelay;this.chunks.length>0;)this.chunks.shift();this.countdownCanceled=!1}getDetailedFreqArray(){return this.analyser.smoothingTimeConstant=0,this.analyser.getByteFrequencyData(this.dataArray),this.dataArray.map((e=>e))}getDetailedTimeArray(){return this.analyser.smoothingTimeConstant=0,this.analyser.getByteTimeDomainData(this.dataArray),this.dataArray.map((e=>e))}setVolume(e){}countdown(){const e=document.getElementById("rock-label");e.classList.add("countdown-label"),e.innerText="Ready",this.countdownCanceled=!1,setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="3"}),1e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="2"}),2e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="1"}),3e3),setTimeout((()=>{this.countdownCanceled||(e.innerText=""),e.classList.remove("countdown-label")}),4e3)}calibrateLag(){if(this.playingLoud&&this.queue.length>0){const e=this.queue[0].endTime-this.queue[0].startTime;e>3&&this.queue[0].audio.currentTime<.9*e&&(this.queue[0].audio.currentTime=this.loudPlayer.currentTime+1*this.masterInfo.songDelay/1e3-this.queue[0].startTime)}}}function H(e,t,s){let i="note-leaving-left";"slide-b"!==e&&"slide-right"!==e||(i="note-leaving-right"),"slide-a"===e&&3===s&&Math.random()>.5&&(i="note-leaving-right");const n=document.createElement("div");n.classList.add("note"),n.classList.add(i),document.getElementById(t).appendChild(n),setTimeout((()=>{n.remove()}),1e3)}console.log("initiating beatburner");const D=new Audio,N=new Audio,F=new Audio,R=new Audio,O=new Audio,q=[];q.push(R),q.push(O),[[D,"whoosh"],[N,"static"],[F,"guitar"],[R,"twang1"],[O,"twang2"]].forEach((e=>{fetch(`./effects/${e[1]}.txt`).then((t=>{t.text().then((t=>{e[0].setAttribute("src",`data:audio/x-wav;base64,${t}`)}))}))})),setTimeout((()=>{document.getElementById("start-curtain").remove()}),1100),setTimeout((()=>{!function(){setTimeout((()=>{D.play()}),400),setTimeout((()=>{N.play()}),1500),setTimeout((()=>{for(let e=0;e<50;e++)setTimeout((()=>{xe(["tapper-left","tapper-a","tapper-b","tapper-right"][Math.floor(4*Math.random())])}),1500*Math.random())}),1800);let e="first-time-menu";g().then((t=>{t.oldUser&&(e="source-menu")})),setTimeout((()=>{pe.showMenu(e),"flyAway"!==oe.animationStyle&&"both"!==oe.animationStyle||["bulb-left","bulb-a","bulb-b","bulb-right"].forEach((e=>{document.getElementById(e).classList.add("hidden")}))}),3700),setTimeout((()=>{F.play()}),3500)}()}),1e3);const{allSlides:$,targetBoundSizes:G,minNoteGap:Y,maxTailLength:W}=w;let V=w.songDelay,z=document.body.clientWidth,U=document.body.clientHeight,j=Math.min(z,U),K=1.5*j,J=1.365*j;const Q=1*J/(V-2e3),Z=1*Q*100,X={top:J-Z,bottom:J+Z};!function(){if(n())console.log("mobile woo!"),function(){document.mobile=!0;const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="./style/styleMobile.css",document.head.appendChild(e);const t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="./style/noteColorsMobile.css",document.head.appendChild(t),["fog-top-left","fog-top-right","fog-gradient-left","fog-gradient-right"].forEach((e=>{document.getElementById(e).remove()})),setTimeout((()=>{le.initializeMobileBackground(),document.getElementById("background-css").remove();const e=document.getElementById("game-container").clientHeight;oe.travelLength=w.mobile.travelLength*e,oe.autoAdjustment=.05*oe.travelLength;const t=1*oe.travelLength/(oe.songDelay-2e3)*oe.targetTime;oe.targetBounds.top=oe.travelLength-t,oe.targetBounds.bottom=oe.travelLength+t,oe.maxTailLength=1*w.mobile.maxTailLength*oe.travelLength,oe.slideLength=1.3*oe.travelLength}),1e3),[["tapper-left","slide-left","note-leaving-left","dummy-tapper-left","dummy-left","slide-left","b-slide-left"],["tapper-right","slide-right","note-leaving-right","dummy-tapper-right","dummy-right","slide-right","b-slide-right"],["tapper-a","slide-a","note-leaving-left","dummy-tapper-a","dummy-a","slide-a","b-slide-a"],["tapper-b","slide-b","note-leaving-right","dummy-tapper-b","dummy-b","slide-b","b-slide-b"]].forEach((e=>{document.getElementById(e[0]).addEventListener("touchstart",(t=>{ve(...e)})),document.getElementById(e[3]).addEventListener("touchstart",(t=>{ve(...e)})),document.getElementById(e[4]).addEventListener("touchstart",(t=>{ve(...e)})),document.getElementById(e[5]).addEventListener("touchstart",(t=>{ve(...e)})),document.getElementById(e[6]).addEventListener("touchstart",(t=>{ve(...e)}))})),document.addEventListener("touchend",(e=>{"dummy-left"!==e.target.id&&"dummy-tapper-left"!==e.target.id&&"a-slide-left"!==e.target.id&&"b-slide-left"!==e.target.id&&"slide-left-flash"!==e.target.id&&"slide-left-flash-sustain"!==e.target.id&&"slide-left-note-lighted"!==e.target.id||Be("tapper-left"),"dummy-a"!==e.target.id&&"dummy-tapper-a"!==e.target.id&&"a-slide-a"!==e.target.id&&"b-slide-a"!==e.target.id&&"slide-a-flash"!==e.target.id&&"slide-a-flash-sustain"!==e.target.id&&"slide-a-note-lighted"!==e.target.id||Be("tapper-a"),"dummy-b"!==e.target.id&&"dummy-tapper-b"!==e.target.id&&"a-slide-b"!==e.target.id&&"b-slide-b"!==e.target.id&&"slide-b-flash"!==e.target.id&&"slide-b-flash-sustain"!==e.target.id&&"slide-b-note-lighted"!==e.target.id||Be("tapper-b"),"dummy-right"!==e.target.id&&"dummy-tapper-right"!==e.target.id&&"a-slide-right"!==e.target.id&&"b-slide-right"!==e.target.id&&"slide-right-flash"!==e.target.id&&"slide-right-flash-sustain"!==e.target.id&&"slide-right-note-lighted"!==e.target.id||Be("tapper-right")})),document.getElementById("change-tapper-keys-item").classList.add("hidden")}();else{const e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="./style/desktop.css",document.head.appendChild(e)}}();const _=new Set,ee={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},te={"slide-right":new Set,"slide-left":new Set,"slide-a":new Set,"slide-b":new Set},se={"slide-right":null,"slide-left":null,"slide-a":null,"slide-b":null},ie=["KeyS","KeyC","KeyB","KeyJ"],ne={"tapper-left":!1,"tapper-a":!1,"tapper-b":!1,"tapper-right":!1};let ae=0;const oe={algorithm:"A",allSlides:$,animatedBackground:!0,animations:!0,animationStyle:"lightUp",audioLoaded:!1,autoAdjustment:0,autoCalibrating:!0,canEnterCode:!0,currentSong:"",double:!0,doubleFrequency:"few",effects:!0,extendedTutorial:!1,hapticsOnHit:!0,manualDelay:0,maxTailLength:W,minNoteGap:Y,mostRecentNotesOrTails:ee,notes:_,noteSpeed:Q,onFire:!1,promptedCalibration:!1,puttingOutFire:!1,radioCode:"mvn925",sendStat:!0,slideLength:K,sliderPos:0,songActive:!1,songAtStart:!0,songDelay:V,songNotesHit:0,songNotesMissed:0,songStreak:0,streak:0,streaming:!1,sustainedNotes:!0,sustainedNotesFrequency:"few",tapperKeys:ie,targetBounds:X,targets:te,targetTails:se,targetTime:100,travelLength:J,useShortSteps:!0,vMin:j,waitingForKey:!1},le=new class{constructor(e){this.masterInfo=e,this.valsQueue=[],this.initializeColors(),this.initializeBackground()}addValsArrayToQueue(e){this.valsQueue.push([e,performance.now()])}animateBackground(e){if(!this.masterInfo.animatedBackground)return;this.addValsArrayToQueue(e);const t=performance.now()-this.masterInfo.songDelay;let s=null,i=0;for(let e=0;e<this.valsQueue.length;e++){const n=this.valsQueue[e];if(!(n[1]<t)){s=n[0];break}i+=1}for(let e=0;e<i;e++)this.valsQueue.shift();if(document.mobile){this.changeColors();const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`;const t=document.getElementById("background-left"),i=document.getElementById("background-right");this.masterInfo.onFire||e[0],t.style.background=`linear-gradient(\n                to left,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`,i.style.background=`linear-gradient(\n                to right,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`,document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[0]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n                to top,\n                rgba(${e[0]}, 0) 0%,\n                rgba(${e[0]}, 1) 100%)`;let n=0;s.forEach((e=>{n+=e}));const a=s[4];if(this.distVals){if(this.distVals.push(a),this.distVals.length>80)for(;this.distVals.length>80;)this.distVals.shift()}else this.distVals=[a];const o=Math.min(...this.distVals),l=100-100*(a-o)/(Math.max(...this.distVals)-o);if(this.percents){if(this.percents.push(l),this.percents.length>5)for(;this.percents.length>5;)this.percents.shift()}else this.percents=[l];const r=function(e){let t=0;return e.forEach((e=>{t+=e})),t/e.length}(this.percents),d=Math.pow(.4*r,.75);t.style.width=`${5+d}%`,i.style.width=`${5+d}%`}else if(s){let e=0;if(s.forEach((t=>{e+=t})),e>0){const t=s.map((t=>1*t/e)),i=60*t[0],n=i+10,a=n+60*t[1],o=a+10,l=o+60*t[2],r=l+10;this.changeColors();const d=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to right,\n                            rgba(${d[0]},1.0) ${i}%,\n                            rgba(${d[1]},1.0) ${n}% ${a}%,\n                            rgba(${d[2]},1.0) ${o}% ${l}%,\n                            rgba(${d[3]},1.0) ${r}%\n                        )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((e=>{document.getElementById(e).style.background=`linear-gradient(\n                            to left,\n                            rgba(${d[0]},1.0) ${i}%,\n                            rgba(${d[1]},1.0) ${n}% ${a}%,\n                            rgba(${d[2]},1.0) ${o}% ${l}%,\n                            rgba(${d[3]},1.0) ${r}%\n                        )`}))}}}changeColors(){this.colors.forEach(((e,t)=>e.map(((e,s)=>{Math.random()>.9&&(e[1]=1===e[1]?-1:1);const i=t===this.colors.length-1?t:t+1,n=t===this.colors.length-1?250:this.colors[i][s][0];e[0]>n-5&&1===e[1]&&(e[1]=-1),e[0]<40&&-1===e[1]&&(e[1]=1),this.masterInfo.onFire?2===t&&(0===s&&e[0]<255?e[1]=1:e[0]>0&&(e[1]=-1)):2===t&&this.masterInfo.puttingOutFire&&(0===s?e[0]>150&&(e[1]=-1):e[0]<150&&(e[1]=1)),Math.random()>.8&&(e[0]+=e[1]*Math.floor(3*Math.random()))}))))}initializeColors(){const e=Math.floor(100*Math.random()),t=Math.floor(100*Math.random()),s=Math.floor(100*Math.random()),i=Math.floor(e+(255-e)*Math.random()),n=Math.floor(t+(255-t)*Math.random()),a=Math.floor(s+(255-s)*Math.random()),o=Math.floor(i+(255-i)*Math.random()),l=Math.floor(n+(255-n)*Math.random()),r=Math.floor(a+(255-a)*Math.random()),d=Math.floor(o+(255-o)*Math.random()),h=Math.floor(l+(255-l)*Math.random()),c=Math.floor(r+(255-r)*Math.random());this.colors=[[[e,1],[t,-1],[s,1]],[[i,-1],[n,1],[a,-1]],[[o,1],[l,-1],[r,1]],[[d,-1],[h,1],[c,-1]]]}initializeBackground(){if(!document.mobile){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));["background-left","fog-top-left","fog-middle-left","fog-gradient-left"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to right,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`})),["background-right","fog-top-right","fog-middle-right","fog-gradient-right"].forEach((t=>{document.getElementById(t).style.background=`linear-gradient(\n                    to left,\n                    rgba(${e[0]},1.0) 20%,\n                    rgba(${e[1]},1.0) 30% 45%,\n                    rgba(${e[2]},1.0) 55% 70%,\n                    rgba(${e[3]},1.0) 80%\n                )`}))}}initializeMobileBackground(){const e=this.colors.map((e=>e.map((e=>e[0])).join(",")));document.getElementById("play-area").style.backgroundColor=`rgb(${e[2]})`,document.getElementById("background-left").style.background=`linear-gradient(\n            to left,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("background-right").style.background=`linear-gradient(\n            to right,\n            rgba(${e[1]}, 0) 0%,\n            rgba(${e[1]}, 1) 100%)`,document.getElementById("fog-mobile").classList.remove("hidden"),document.getElementById("fog-mobile-top").style.backgroundColor=`rgb(${e[0]})`,document.getElementById("fog-mobile-gradient").style.background=`linear-gradient(\n            to top,\n            rgba(${e[0]}, 0) 0%,\n            rgba(${e[0]}, 1) 100%)`}}(oe),re=new class{constructor(e,t,s,i){this.masterInfo=e,this.addNote=t,this.makeTail=s,this.backgroundAnimator=i,this.lastLeft=performance.now(),this.lastMid=performance.now(),this.lastRight=performance.now(),this.lastLeftTail=performance.now(),this.lastMidTail=performance.now(),this.lastRightTail=performance.now(),this.leftSlides=["slide-left","slide-a"],this.rightSlides=["slide-b","slide-right"],this.rightId="slide-right",this.leftId="slide-left",this.lastAll={"slide-left":performance.now(),"slide-a":performance.now(),"slide-b":performance.now(),"slide-right":performance.now()},this.lastAlls=[],this.mostRecentNotes=e.mostRecentNotesOrTails,this.numToneVals=3,this.recentToneVals=[20,50,80],this.sideWithNotes=null,this.last=performance.now(),this.timeSinceLast=0,this.timesSinceLast=[0,0,0,0],this.lastArrs=[],this.rawArrs=[],this.gap=200,this.resetData(),this.doPreciseBetter=!0,this.tallestTowerIndices=[]}resetData(){this.times=[],this.collectArrays=[],this.collectTimeArrays=[],this.timeArrayVariances=[],this.startTime=performance.now(),this.lastTime=performance.now(),this.stepTime=5,this.arrLength=2048,this.aveHillHeights=[],this.tallestTowers=[],this.toneVals=[],this.peakOffset=0,this.prev=!1,this.low=!1,this.lowIdx=!1,this.dir=1}writeTails(e,t,s,i,n){if(this.recentToneVals.length<3||i<2)return;let a={few:5,medium:10,many:15}[this.masterInfo.sustainedNotesFrequency];"radio"===this.masterInfo.songMode&&(a=Math.floor(a/2)),t.forEach((i=>{const n=this.mostRecentNotes[i];if(n){let o=n.val,l=o,r=!1,d=!0;if(n.isTail)d=!0;else{d=!0;let e=4e3;s.forEach((t=>{let s=!1,i=l;t.forEach((t=>{const n=Math.abs(t[1]-i);n<a&&(s=!0,n<e&&(e=n,l=t[1]))})),s||(d=!1)}))}let h=!0;n.isTail&&n.totalHeight>2e3/(this.masterInfo.songDelay-2e3)*1.5*this.masterInfo.travelLength&&(h=!1);let c=4e3;if(e.forEach((e=>{const t=Math.abs(o-e[1]);t<a&&(r=!0,t<c&&(c=t,n.val=e[1]))})),r&&d&&h){const e=performance.now();4===t.length?this.leftSlides.includes(i)?(this.lastLeft=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastRight=e,this.lastAll[i]=e,this.makeTail(i,n)):3===t.length?i===this.rightId?(this.lastRight=e,this.lastAll[i]=e,this.makeTail(i,n)):i===this.leftId?(this.lastLeft=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastMid=e,this.lastAll[i]=e,this.makeTail(i,n)):(this.lastAll[i]=e,this.makeTail(i,n))}else n.isTail&&n.totalHeight<.1*this.masterInfo.travelLength&&(n.cloud.remove(),n.note.remove(),n.parentNote.tail=null),this.mostRecentNotes[i]=null}}))}writeNotes(e,t,s,i,n,a=0){const o=performance.now()-a;for(this.times.push(o);this.times[0]<o-4e3;)this.times.shift();this.lastTime+=this.stepTime;let l=!1,r=!1;const d=e,h=t;let c,m,u;if(this.timeArrayVariances.push(Math.max(...h)-Math.min(...h)),this.doPreciseBetter){let e=d[0],t=e,n=1,a=0;const h=[];d.forEach(((s,i)=>{if(s>0)if(s>e)-1===n&&(t=s,a=i,n=1);else if(1===n){const o=e-t;o>0&&h.push([o,i-1,i-a]),t=s,n=-1}else t=s;e=s}));const g=.9*h.length,A=h.slice(g,h.length);this.tallestTowers.push(A);const y=A.map((e=>e[1])).sort(((e,t)=>e>t?1:-1));let f=0;for(let e=Math.floor(y.length/5);e<y.length;e++)f+=y[e]-y[e-1];let p=0;y.length>1&&(p=f/(y.length-1));let I=0,B=0;A.forEach((e=>{e[0]>I&&(I=e[0],B=e[1])})),this.aveHillHeights.push(I),this.toneVals.push(p),this.tallestTowerIndices.push(B),this.rawArrs.push(d),[this.aveHillHeights,this.timeArrayVariances,this.tallestTowers,this.toneVals,this.rawArrs,this.tallestTowerIndices].forEach((e=>{for(;e.length>this.times.length;)e.shift()}));let v=4;"B"===this.masterInfo.algorithm&&(v=2),(this.times[this.times.length-1]-this.times.length[0]<3900||this.times.length<100)&&(v=1);const E=[],b={};let L=this.aveHillHeights[0],T=1,w=L,k=0,S=0,M=0;this.times.length>100&&(S=(1*this.times[this.times.length-1]-this.times[0])/this.times.length,S>0&&(M=1*this.masterInfo.manualDelay/S));const C=1900;let P=0;for(;this.times[P]<o-C+M&&(P+=1,this.times[P]););if(0===P)return;const H=Math.floor(this.aveHillHeights.length/(2*v));let D=Math.floor(P-H),N=Math.floor(P+H);if(D<0)return;if(D>this.aveHillHeights.length-1)return;if(N<0)return;if(N>this.aveHillHeights.length-1)return;for(let e=D;e<N;e++){const t=this.aveHillHeights[e];if(t>L)-1===T&&(w=L,k=e-1,T=1);else{if(1===T){const t=L-w;t>0&&(E.push([t,k,this.timeArrayVariances[e]]),b[k]=e-k)}w=t,k=e}L=t}E.sort(((e,t)=>e[2]>t[2]?1:-1));const F=b[P]+P;F&&(this.peakOffset=b[P]);let R=0,O=0;this.tallestTowers[P+this.peakOffset].forEach((e=>{e[0]>R&&(R=e[0],O=e[1])})),m=O,c=this.tallestTowerIndices[F+this.peakOffset];const q=4e3/this.tallestTowers.length;let $=Math.ceil(200/q);this.masterInfo.sustainedNotes&&this.writeTails(this.tallestTowers[P+this.peakOffset],s,this.tallestTowers.slice(P+this.peakOffset+1,P+this.peakOffset+1+$),i,this.timeArrayVariances[P]);const G=this.timeArrayVariances[P+this.peakOffset];Math.max(...this.aveHillHeights),Math.min(...this.aveHillHeights);this.aveHillHeights[this.aveHillHeights.length-1];let Y={1:.15,2:.3,3:.5,4:.75,5:1}[i];if(3===s.length){let e=1-Y;e*=.9,Y=1-e}if(2===s.length){let e=1-Y;e*=.65,Y=1-e}let W={1:2,2:4,3:10,4:15,5:60}[i];if(3===s.length&&(W=Math.ceil(.9*W)),2===s.length&&(W=Math.ceil(.65*W)),G<80){const e=1*G/80;W=Math.floor(W*e)}const V={few:.75,medium:.5,many:0}[this.masterInfo.doubleFrequency],z="A"===this.masterInfo.algorithm?W:Y*E.length,U=E.slice(Math.floor(E.length-z),E.length-1);U.forEach(((e,t)=>{e[1]===P&&(l=!0,t>V*U.length&&(r=!0))})),this.lastAlls.push({"slide-left":o-this.lastAll["slide-left"],"slide-a":o-this.lastAll["slide-a"],"slide-b":o-this.lastAll["slide-b"],"slide-right":o-this.lastAll["slide-right"]}),this.lastAlls.length>this.times.length&&this.lastAlls.shift();const j=[Math.pow(x(d.slice(d.length-2048,d.length-1536)),1.5),Math.pow(x(d.slice(d.length-1536,d.length-1024)),1.5),Math.pow(x(d.slice(d.length-1024,d.length-512)),1.5),Math.pow(x(d.slice(d.length-512,d.length-256)),1.5),this.timeArrayVariances[this.timeArrayVariances.length-1]];this.lastArrs.push(j),this.lastArrs.length>8&&this.lastArrs.shift();const K=[];for(let e=0;e<j.length;e++)K.push(x(this.lastArrs.map((t=>t[e]))));if(this.backgroundAnimator.animateBackground(K),G<15)return;if(o-this.times[0]<1900)return;u=this.toneVals[P]}if("demo"===this.masterInfo.songMode&&1===i){const e=C[this.masterInfo.songCode];if(e)if(void 0===this.lastSongTime||void 0===this.lastSongTime||n<this.lastSongTime)this.lastSongTime=0,this.noteIdx=0,l=!1;else{let t=!1;for(;e[this.noteIdx]<(1*this.masterInfo.songDelay-4e3)/1e3+n+2-this.masterInfo.manualDelay/1e3;)this.noteIdx+=1,t=!0;t?(c=u,l=!0):l=!1,this.lastSongTime=n}}if(l){const e=this.getSlideToUse(c,s.length);this.attemptNoteWrite({slideToUse:e,slideIds:s,noteVal:m,toneVal:c,addNote:this.addNote,marked:!1,mobile:!0,notesPerSecond:i,canDouble:r,timeOffset:a})}}getSlideToUse(e,t){const s=this.recentToneVals.map((e=>e)).sort(((e,t)=>e>t?1:-1));if(3===this.recentToneVals.length&&4===t)return e<this.recentToneVals[0]?"slide-left":e<this.recentToneVals[1]?"slide-a":e<this.recentToneVals[2]?"slide-b":"slide-right";const i=s[s.length-1],n=s[0];if(e>i)return"slide-right";if(e<n)return"slide-left";if(4===t){let t="slide-right";return e<s[Math.round(.75*s.length)]&&(t="slide-b",e<s[Math.round(.5*s.length)]&&(t="slide-a",e<s[Math.round(.25*s.length)]&&(t="slide-left"))),t}if(3===t){let t="slide-left";return e>s[Math.round(.33*s.length)]&&(t="slide-a",e>s[Math.round(.66*s.length)]&&(t="slide-right")),t}if(2===t){let t="slide-left";return e>s[Math.round(.5*s.length)]&&(t="slide-right"),t}let a="slide-left";return 4===t?e>s[0]&&(a="slide-a",e>s[1]&&(a="slide-b",e>s[2]&&(a="slide-right"))):3===t?e>s[0]&&(a="slide-a",e>s[2]&&(a="slide-right")):e>s[1]&&(a="slide-right"),a}attemptNoteWrite(e){const{slideToUse:t,slideIds:s,noteVal:i,toneVal:n,addNote:a,marked:o,mobile:l,notesPerSecond:r,canDouble:d,timeOffset:h}=e;let c=!1,m=this.gap;if(m*=.75,t){const e=performance.now()-h;if(e-this.lastAll[t]>this.masterInfo.minNoteGap)if(l&&s.length>2)if(3===s.length){if(this.mostRecentNotes["slide-a"]&&this.mostRecentNotes["slide-a"].isTail&&t!==this.sideWithNotes)return;const s=e-this.lastLeft,n=e-this.lastMid,l=e-this.lastRight;t===this.rightId?(s>m||n>m)&&(a(t,i,o,h,d),c=!0,this.sideWithNotes=t,this.lastRight=e,this.lastAll[t]=e):t===this.leftId?(n>m||l>m)&&(a(t,i,o,h,d),c=!0,this.sideWithNotes=t,this.lastLeft=e,this.lastAll[t]=e):(s>m||l>m)&&(a(t,i,o,h,d),c=!0,this.lastMid=e,this.lastAll[t]=e)}else{const s=e-this.lastLeft,n=e-this.lastRight;this.leftSlides.includes(t)?s>m&&(a(t,i,o,h,d),c=!0,this.lastLeft=e,this.lastAll[t]=e):n>m&&(a(t,i,o,h,d),c=!0,this.lastRight=e,this.lastAll[t]=e)}else if(r<3){const s=e-this.lastLeft,n=e-this.lastRight;this.leftSlides.includes(t)?s>m&&(a(t,i,o,h,d),c=!0,this.lastLeft=e,this.lastAll[t]=e):n>m&&(a(t,i,o,h,d),c=!0,this.lastRight=e,this.lastAll[t]=e)}else a(t,i,o,h,d),c=!0,this.lastAll[t]=e}c&&(this.recentToneVals.push(n),this.lastValTime=performance.now(),this.recentToneVals.length>this.numToneVals&&this.recentToneVals.shift())}}(oe,Le,Ee,le),de=new class{constructor(e,t,s,i,n,a,o=4){this.masterInfo=e,this.recents=e.mostRecentNotesOrTails,this.notes=e.notes,this.allSlides=e.allSlides,this.slides=[this.allSlides[0],this.allSlides[1],this.allSlides[3]],this.notesPerSecond=2,g().then((e=>{this.notesPerSecond=e.level,this.setNumSlides(e.slides),this.labelFeedbackModal()})),this.targetTails=e.targetTails,this.targets=e.targets,this.targetBounds=e.targetBounds,this.addNote=i,this.makeTail=n,this.triggerMissedNote=a,this.noteWriter=t,this.backgroundAnimator=s,this.time=0,this.animating=!1,this.arrays=[];for(let e=0;e<o;e++)this.arrays.push([]);this.times=[],this.timeStep=5,this.lastTime=0,this.noteResults=[],this.notesHit=0,this.notesMissed=0,this.arrayNow=[1,1,1,1],this.currentSlider="a-slider",this.oldSliderPos=0,this.movingBothSliders=!1}setNotesPerSecond(e){this.notesPerSecond=e,this.labelFeedbackModal()}setNumSlides(e){this.slides=2===e?[this.allSlides[0],this.allSlides[3]]:3===e?[this.allSlides[0],this.allSlides[1],this.allSlides[3]]:[this.allSlides[0],this.allSlides[1],this.allSlides[2],this.allSlides[3]],this.labelFeedbackModal()}labelFeedbackModal(){const e={1:"Super easy",2:"Easy",3:"Medium",4:"Hard",5:"Crazy hard"}[this.notesPerSecond];document.getElementById("song-difficulty").innerText=`${e} / ${this.slides.length} slides`}recordNoteHit(){for(this.notesHit+=1,this.noteResults.push(!0);this.noteResults.length>75;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;E(this.notesHit,this.notesMissed,this.masterInfo)}recordNoteMissed(){for(this.notesMissed+=2,this.noteResults.push(!1),this.noteResults.push(!1);this.noteResults.length>75;)this.noteResults.shift()?this.notesHit-=1:this.notesMissed-=1;E(this.notesHit,this.notesMissed,this.masterInfo)}runAnimation(e){this.time=performance.now(),this.animating=!0,this.animate(e),this.slideStartTime=performance.now()}stopAnimation(e=!1){e||c(this.masterInfo,this.noteWriter),this.animating=!1}animate(e){const t=performance.now();if("tutorial"===this.masterInfo.songMode||"calibrate"===this.masterInfo.songMode){const s=t-this.time;return this.time=t,b(this.masterInfo.notes,this.masterInfo.noteSpeed,this.slides,this.targetTails,this.targets,this.masterInfo.targetBounds,this.triggerMissedNote,this.recents,this.masterInfo.slideLength,s,this,this.masterInfo.songMode,this.masterInfo.travelLength),void(this.animating&&requestAnimationFrame((()=>this.animate(e))))}const{player:s,algorithm:i}=e,n=[];if(t-this.lastTime>35||!this.masterInfo.useShortSteps)n.push(t),this.lastTime=t;else{let e=this.lastTime+this.timeStep;for(;e<t;)n.push(e),e+=this.timeStep,this.lastTime=e}n.forEach((e=>{const i=t-e,n=this.masterInfo.songDelay+i;s.calibrateLag(n);const a=s.getDetailedFreqArray(),o=s.getDetailedTimeArray();"demo"===this.masterInfo.songMode?this.noteWriter.writeNotes(a,o,this.slides,this.notesPerSecond,s.song2.currentTime,i):this.noteWriter.writeNotes(a,o,this.slides,this.notesPerSecond,0,i)}));const a=t-this.time;this.time=t,b(this.masterInfo.notes,this.masterInfo.noteSpeed,this.slides,this.targetTails,this.targets,this.masterInfo.targetBounds,this.triggerMissedNote,this.recents,this.masterInfo.slideLength,a,this,this.masterInfo.songMode,this.masterInfo.travelLength),this.animating&&requestAnimationFrame((()=>this.animate(e)))}}(oe,re,le,Le,Ee,Me),he=new class{constructor(e){this.masterInfo=e,this.resetCounters(),this.streaks={l1:0,l2:0,l3:0,l4:0,l5:0},this.currentStreak=0,this.activateMenuButtons()}setup(){return new Promise((e=>{this.populateData().then((()=>{this.getPreviousStreak().then((()=>{this.masterInfo.streak=this.currentStreak,e()}))}))}))}getPreviousStreak(){return new Promise((e=>{g().then((t=>{this.streaks[`l${t.stats.streakLevel}`]=t.stats.currentStreak,this.currentStreak=t.stats.currentStreak,this.currentStreakLevel=t.stats.streakLevel,e()}))}))}resetCounters(){this.notesHit={l1:0,l2:0,l3:0,l4:0,l5:0},this.notesMissed={l1:0,l2:0,l3:0,l4:0,l5:0},this.notesHitOnFire=0}updateInfo(){this.updateProfile().then((()=>{this.populateData()}))}updateProfile(){return new Promise((e=>{g().then((t=>{["l1","l2","l3","l4","l5"].forEach((e=>{this.streaks[e]>t.stats.streaks[e]&&(t.stats.streaks[e]=this.streaks[e]);const s=1*t.stats.accuracy[e]/100,i=(0===s?0:1*t.stats.notesHit[e]/s)-t.stats.notesHit[e],n=t.stats.notesHit[e]+this.notesHit[e],a=i+this.notesMissed[e],o=1*Math.round(1e3*n/(n+a))/10;t.stats.accuracy[e]=o,t.stats.notesHit[e]+=this.notesHit[e]})),t.stats.notesHitOnFire+=this.notesHitOnFire,t.stats.currentStreak=this.currentStreak,this.resetCounters(),this.updateRank(t),u().then((()=>{e()}))}))}))}updateRank(e){let t="groupie";const s=e.stats.notesHit.l1+e.stats.notesHit.l2+e.stats.notesHit.l3+e.stats.notesHit.l4+e.stats.notesHit.l5;s>1e3&&(t="backup bass"),s>1e4&&(t="lead guitar"),s>3e4&&(t="pop star"),s>8e4&&(t="rock icon"),s>15e4&&(t="music legend"),s>3e5&&(t="beat burner"),e.stats.rank=t}recordNoteHit(e,t=!1){this.notesHit[`l${e}`]+=1,t&&(this.notesHitOnFire+=1),this.currentStreak+=1,e<this.currentStreakLevel&&(this.currentStreakLevel=e,g().then((e=>{e.stats.streakLevel=this.currentStreakLevel,u()})))}recordNoteMissed(e){this.notesMissed[`l${e}`]+=1,this.currentStreak>this.streaks[`l${this.currentStreakLevel}`]&&(this.streaks[`l${this.currentStreakLevel}`]=this.currentStreak),this.currentStreak=0,this.currentStreakLevel=6}activateMenuButtons(){document.getElementById("show-stats").addEventListener("click",(()=>{document.getElementById("stats-modal").classList.remove("hidden")})),document.getElementById("close-stats-button").addEventListener("click",(()=>{document.getElementById("stats-modal").classList.add("hidden")}))}populateData(){return new Promise((e=>{g().then((t=>{if(t.stats){document.getElementById("stats-rank").innerText=t.stats.rank,[["stats-super-easy-streak",t.stats.streaks.l1],["stats-easy-streak",t.stats.streaks.l2],["stats-medium-streak",t.stats.streaks.l3],["stats-hard-streak",t.stats.streaks.l4],["stats-crazy-hard-streak",t.stats.streaks.l5]].forEach((e=>{document.getElementById(e[0]).innerText=e[1]})),[["stats-super-easy-percent",t.stats.accuracy.l1],["stats-easy-percent",t.stats.accuracy.l2],["stats-medium-percent",t.stats.accuracy.l3],["stats-hard-percent",t.stats.accuracy.l4],["stats-crazy-hard-percent",t.stats.accuracy.l5]].forEach((e=>{e[1]?document.getElementById(e[0]).innerText=`${e[1]} %`:document.getElementById(e[0]).innerText="- %"}));const s=t.stats.notesHit.l1+t.stats.notesHit.l2+t.stats.notesHit.l3+t.stats.notesHit.l4+t.stats.notesHit.l5,i=t.stats.notesHitOnFire;document.getElementById("stats-total-notes-hit").innerText=s;let n=Math.round(1e3*i/s);n>0?n/=10:n="-",document.getElementById("stats-notes-hit-on-fire").innerText=`${i} (${n} %)`,e()}else t.stats={currentStreak:0,streakLevel:6,notesHitOnFire:0,rank:"groupie",streaks:{l1:0,l2:0,l3:0,l4:0,l5:0},accuracy:{l1:100,l2:100,l3:100,l4:100,l5:100},notesHit:{l1:0,l2:0,l3:0,l4:0,l5:0}},u().then((()=>{e()}))}))}))}}(oe),ce=new class{constructor(e,t,s,i){this.masterInfo=e,this.song1=new Audio,this.song2=new Audio,this.onEnd=i,this.playing1=!1,this.playing2=!1,this.paused=!1,this.arrayPlay=!1,this.delayPlay=!1,this.timeStarted=!1,this.song2Timeout=!1,this.timeToStart2=e.songDelay,this.song1.addEventListener("ended",(()=>{this.playing1=!1})),this.song2.addEventListener("ended",(()=>{this.masterInfo.songActive=!1,this.playing2=!1,this.timeToStart2=this.masterInfo.songDelay,this.restart(),a("button-play"),i()})),this.waiting=!1,this.countdownCanceled=!1,this.freqArrays=[],this.times=[]}setPlayerReady(e){this.song1.oncanplaythrough=e,this.readyCallback=e}countdown(){const e=document.getElementById("rock-label");e.classList.add("countdown-label"),e.innerText="Ready",this.countdownCanceled=!1,setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="3"}),1e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="2"}),2e3),setTimeout((()=>{this.countdownCanceled?e.classList.remove("countdown-label"):e.innerText="1"}),3e3),setTimeout((()=>{this.countdownCanceled||(e.innerText=""),e.classList.remove("countdown-label")}),4e3)}start(){this.masterInfo.songActive=!0,this.delayPlay?this.mp3.play():(this.masterInfo.songAtStart&&this.countdown(),this.masterInfo.songAtStart=!1,this.arrayPlay?this.songPiece.audio.play():this.song1.play(),this.playing1=!0,this.timeStarted=performance.now(),this.timeToStart2?(setTimeout((()=>{this.startSong2()}),this.timeToStart2),this.waiting=!0):(this.song2.play(),this.playing2=!0),this.paused=!1)}startSong2(){this.paused||(this.song2.play(),this.playing2=!0,this.timeToStart2=!1,this.waiting=!1)}pause(){this.masterInfo.songActive=!1,this.delayPlay?this.mp3.pause():(this.playing2?(this.song2.pause(),this.playing2=!1,this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.playing1=!1):this.song1.playing&&(this.arrayPlay?this.songPiece.audio.pause():this.song1.pause(),this.song1.playing=!1,this.song1.pause(),clearTimeout(this.song2Timeout),this.timeToStart2=performance.now()-timeStarted),this.countdownCanceled=!0,this.paused=!0)}restart(){this.delayPlay?this.mp3.restart():this.arrayPlay?(this.songPiece.audio.pause(),this.arrayPos=0,this.songPiece=this.piecesArray[this.arrayPos],this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.masterInfo.songDelay,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0):(this.song1.pause(),this.song2.pause(),this.playing1=!1,this.playing2=!1,this.waiting&&(clearTimeout(this.song2Timeout),this.waiting=!1),this.timeToStart2=this.masterInfo.songDelay,this.song1.currentTime=0,this.song2.currentTime=0,this.masterInfo.songAtStart=!0,this.countdownCanceled=!0)}setSource(e,t=!1,s=!1,i=!1){if(i)return this.mp3=new P(this.masterInfo,e,this.onEnd),void(this.delayPlay=!0);if(t)if(this.delayPlay=!1,s){this.arrayPlay=!0,this.arrayPos=0;let t=0;s.forEach((e=>{null!==e.startTime&&(t+=1)})),this.piecesArray=s.slice(0,t),this.songPiece=this.piecesArray[this.arrayPos],this.piecesArray.forEach((e=>{e.audio.addEventListener("ended",(()=>{this.startNextPiece()}))})),this.song2.setAttribute("src",e),s.length>0&&(this.restart(),this.masterInfo.songAtStart=!0)}else this.piecesArray&&this.piecesArray.forEach((e=>{e.ctx&&e.ctx.close()})),this.piecesArray=null,this.songPiece=null;else this.delayPlay=!1,this.arrayPlay=!1,this.restart(),this.song1.setAttribute("src",e),this.song2.setAttribute("src",e),this.masterInfo.songAtStart=!0}startNextPiece(){this.arrayPos+=1,this.piecesArray[this.arrayPos]&&(this.songPiece=this.piecesArray[this.arrayPos],this.songPiece.audio.play())}getDetailedFreqArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteFrequencyData(this.songPiece.array),this.songPiece.array.map((e=>e))):this.delayPlay?this.mp3.getDetailedFreqArray():(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteFrequencyData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDetailedTimeArray(){return this.arrayPlay?(this.songPiece.analyser.smoothingTimeConstant=0,this.songPiece.analyser.getByteTimeDomainData(this.songPiece.array),this.songPiece.array.map((e=>e))):this.delayPlay?this.mp3.getDetailedTimeArray():(this.detailedAnalyser.smoothingTimeConstant=0,this.detailedAnalyser.getByteTimeDomainData(this.detailedDataArray),this.detailedDataArray.map((e=>e)))}getDataFreqArray(){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.masterInfo.songDelay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}setVolume(e){this.delayPlay?this.mp3.setVolume(e):this.song2.volume=e}calibrateLag(e=this.masterInfo.songDelay){const t=1*e/1e3;this.delayPlay?this.mp3&&this.mp3.calibrateLag():this.arrayPlay?this.playing2&&this.songPiece.audio.currentTime<.5*this.songPiece.audio.duration&&(this.songPiece.audio.currentTime=this.song2.currentTime+t-this.songPiece.startTime):this.song1.currentTime>t+.1&&(this.song1.currentTime=this.song2.currentTime+t)}}(oe,"aintOverYou",32,(()=>{he.updateInfo(),de.stopAnimation(),oe.songStreak>ae&&(ae=oe.songStreak),document.getElementById("feedback").classList.remove("hidden");const e=1*oe.songNotesHit/(oe.songNotesHit+oe.songNotesMissed);document.getElementById("percent-bar-inner-container").style.width=100*e+"%";const t=Math.round(1e3*e)/10;var s;if("demo"===oe.songMode&&(s=t,oe.currentSong,new Promise((e=>{g().then((t=>{const i=`l${de.notesPerSecond}s${de.slides.length}`,n=oe.songCode,a=t.progress[i][n];a?s>a&&(t.progress[i][n]=s):t.progress[i][n]=s,u().then((()=>{ye.activateSongSelect(!1),e()}))}))}))),t<{1:75,2:80,3:85,4:90,5:95}[de.notesPerSecond]?(document.getElementById("song-fail").classList.remove("hidden"),document.getElementById("song-pass").classList.add("hidden"),document.getElementById("feedback-percent").style.color="red"):(document.getElementById("song-fail").classList.add("hidden"),document.getElementById("song-pass").classList.remove("hidden"),document.getElementById("feedback-percent").style.color="green"),document.getElementById("feedback-title").innerText=oe.currentSong,"demo"===oe.songMode&&S[oe.songCode]?(document.getElementById("song-information-bar").innerHTML=S[oe.songCode],document.getElementById("song-information-bar").classList.remove("hidden")):(document.getElementById("song-information-bar").innerHTML="",document.getElementById("song-information-bar").classList.add("hidden")),document.getElementById("feedback-title").innerText=oe.currentSong,document.getElementById("feedback-percent").innerText=`Tap accuracy: ${t}%`,document.getElementById("feedback-streak").innerText=`Longest streak: ${ae}`,document.getElementById("feedback-streak-overall").innerText=`Current streak: ${oe.streak}`,function(e,t){const s=performance.now();t.forEach((e=>{document.getElementById(e).style.opacity="0"})),Ce("percent-bar",t,s,800)}(0,["feedback-percent-title","feedback-streak","feedback-streak-overall"]),oe.songNotesMissed=0,oe.songNotesHit=0,oe.songStreak=0,oe.extendedTutorial){const e=document.getElementById("tutorial-step-10");e.style.top="5vh",e.style.left="6vh",e.style.zIndex=1e3,e.classList.remove("hidden")}})),me=new class{constructor(e,t){this.masterInfo=e,this.queue=[],this.started=!1,this.current=null,this.muted=!1,this.freqArrays=[],this.times=[],this.blobStreaming=!1,this.blobs=[]}calibrateLag(e=this.masterInfo.songDelay){const t=1*e/1e3;this.player&&this.silentPlayer.currentTime>t&&(this.silentPlayer.currentTime=this.player.currentTime+t),this.current&&this.current.silentSong.currentTime>t&&(this.current.silentSong.currentTime=this.current.song.currentTime+t)}playOnDelay(e){e.silentSong.play();const t=this;setTimeout((()=>{t.currentAudio=e.song,e.song.play()}),this.masterInfo.songDelay)}getDetailedFreqArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=0,this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=0,this.analyser.getByteFrequencyData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=0,this.current.analyser.getByteFrequencyData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDetailedTimeArray(){return this.liveStream?(this.liveAnalyser.smoothingTimeConstant=0,this.liveAnalyser.getByteTimeDomainData(this.liveDataArray),this.liveDataArray.map((e=>e))):this.silentPlayer?(this.analyser.smoothingTimeConstant=0,this.analyser.getByteTimeDomainData(this.dataArray),this.dataArray.map((e=>e))):(this.current.analyser.smoothingTimeConstant=0,this.current.analyser.getByteTimeDomainData(this.current.dataArray),this.current.dataArray.map((e=>e)))}getDataFreqArray(){if(this.liveStream){this.liveAnalyser.getByteFrequencyData(this.liveDataArray),this.freqArrays.push(this.liveDataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.masterInfo.songDelay;)this.times.shift(),this.freqArrays.shift();return this.liveDataArray}if(this.silentPlayer){this.analyser.getByteFrequencyData(this.dataArray),this.freqArrays.push(this.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.masterInfo.songDelay;)this.times.shift(),this.freqArrays.shift();return this.dataArray}if(this.current&&!this.muted){this.current.analyser.getByteFrequencyData(this.current.dataArray),this.freqArrays.push(this.current.dataArray.map((e=>e)));const e=performance.now();for(this.times.push(e);this.times[0]<e-this.masterInfo.songDelay;)this.times.shift(),this.freqArrays.shift();return this.current.dataArray}return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}getDataFreqArrayDelayed(e=2e3){let t=0;for(;performance.now()-e>this.times[t]&&(t+=1,this.times[t]););return this.times[t]?this.freqArrays[t]:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}startNextRecording(){this.nextSilentPlayer.volume=0,this.nextSilentPlayer.play(),this.nextSilentPlayer.currentTime=this.silentPlayer.currentTime-1*this.nextDelay/1e3,this.correction=2-this.nextSilentPlayer.currentTime,this.nextSilentPlayer.volume=1,this.silentPlayer.volume=0,this.silentPlayer=this.nextSilentPlayer,this.analyser=this.nextAnalyser,setTimeout((()=>{this.nextPlayer.volume=0,this.nextPlayer.play(),this.nextPlayer.currentTime=this.player.currentTime-1*this.nextDelay/1e3,this.nextPlayer.play(),this.nextPlayer.volume=this.player.volume,this.player.volume=0,this.player=this.nextPlayer}),4e3),setTimeout((()=>{this.startNextRecording()}),this.nextDelay+1e3*this.correction)}setData(e,t=!1){if("stream"===!this.masterInfo.songMode)return;if(this.started||(document.getElementById("initial-received").style.color="gray"),e.liveStream)return document.getElementById("initial-received").style.color="gray",setTimeout((()=>{document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("button-play").classList.add("pulse"),document.getElementById("button-play-beacon").classList.remove("hidden")}),1e3)}),2e3),this.livePlayer&&this.livePlayer.pause(),this.liveStream=!0,this.livePlayer=e.player,this.livePlayer.play(),this.liveAnalyser=e.analyser,this.liveDataArray=e.dataArray,this.gain=e.gain,this.ctx=e.ctx,this.nowGain=e.nowGain,void(this.nowCtx=e.nowCtx);if(e.timeDelay){if(console.log("timeDelay recognized"),this.player){console.log("already have a player");const t=new Audio(`data:audio/x-wav;base64,${e.str}`),s=new Audio(`data:audio/x-wav;base64,${e.str}`),i=new AudioContext,n=i.createMediaElementSource(s);this.nextAnalyser=i.createAnalyser(),n.connect(this.nextAnalyser),i.setSinkId({type:"none"}),this.nextAnalyser.connect(i.destination),this.nextAnalyser.fftSize=4096,this.nextDataArray=new Uint8Array(this.nextAnalyser.frequencyBinCount);const a=()=>{s.removeEventListener("canplaythrough",a),this.nextPlayer=t,this.nextSilentPlayer=s,this.nextDelay=e.timeDelay};s.addEventListener("canplaythrough",a)}else{this.player=new Audio(`data:audio/x-wav;base64,${e.str}`),this.silentPlayer=new Audio(`data:audio/x-wav;base64,${e.str}`);const t=new AudioContext,s=t.createMediaElementSource(this.silentPlayer);this.analyser=t.createAnalyser(),s.connect(this.analyser),t.setSinkId({type:"none"}),this.analyser.connect(t.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount);const i=()=>{this.silentPlayer.removeEventListener("canplaythrough",i),console.log("should hear music in 9 seconds"),document.getElementById("now-streaming").style.color="gray",setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),setTimeout((()=>{this.startNextRecording()}),12e3)}),5e3)};this.silentPlayer.addEventListener("canplaythrough",i)}return}if(t){let t=!0;this.blobs.push(e),console.log(this.blobs.length);const s=new Blob(this.blobs,{type:"audio/ogg; codecs=opus"}),i=new FileReader;return i.onload=e=>{const s=btoa(e.target.result),i=new Audio(`data:audio/x-wav;base64,${s}`),n=new Audio(`data:audio/x-wav;base64,${s}`),a=new AudioContext,o=a.createMediaElementSource(n);this.analyser=a.createAnalyser(),o.connect(this.analyser),a.setSinkId({type:"none"}),this.analyser.connect(a.destination),this.analyser.fftSize=4096,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),n.addEventListener("canplaythrough",(()=>{t&&(this.player?(i.volume=0,n.volume=0,i.currentTime=this.player.currentTime,n.currentTime=this.silentPlayer.currentTime,i.play(),n.play(),i.volume=this.player.volume,n.volume=1,this.player.volume=0,this.silentPlayer.volume=0,this.player=i,this.silentPlayer=n):(this.silentPlayer=n,this.player=i,setTimeout((()=>{this.silentPlayer.play(),setTimeout((()=>{this.player.play(),document.getElementById("connecting-radio").classList.add("hidden")}),4e3),document.getElementById("now-streaming").style.color="gray"}),4e3)),t=!1)}))},i.readAsBinaryString(s),void(this.started=!0)}this.liveStreaming=!1;const s=JSON.parse(e),i=new AudioContext,n=new Audio(`data:audio/x-wav;base64,${s.str}`),a=i.createMediaElementSource(n),l=i.createAnalyser();a.connect(l),i.setSinkId({type:"none"}),l.connect(i.destination),l.fftSize=4096;const r=new Uint8Array(l.frequencyBinCount),d={song:new Audio(`data:audio/x-wav;base64,${s.str}`),notes:s.notes,time:s.time,silentSong:n,analyser:l,dataArray:r};if(this.queue.push(d),console.log("new chunk added to queue"),!this.started&&this.queue.length>1){o("stream"),console.log("starting music "+this.queue.length),this.startNextChunk(),document.getElementById("now-streaming").style.color="gray";const e=document.getElementById("song-label");"keep your shirt on"===e.innerText&&(e.innerText="streaming"),setTimeout((()=>{document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("button-play").classList.add("pulse"),document.getElementById("button-play-beacon").classList.remove("hidden")}),2e3)}}startNextChunk(){this.queue.length<1?("stream"===this.masterInfo.songMode&&(document.getElementById("song-label").innerText="stream ended"),this.started=!1):(this.current=this.queue.shift(),this.playOnDelay(this.current),this.muted&&(this.current.song.volume=0),console.log(this.current.time),setTimeout((()=>{this.startNextChunk()}),this.current.time),this.started=!0)}setVolume(e){this.currentAudio&&(this.currentAudio.volume=e),this.current&&(this.current.song.volume=e),this.player&&(this.player.volume=e),this.livePlayer&&(this.livePlayer.volume=e)}start(){this.masterInfo.songActive=!0,this.liveStream?this.ctx.resume():this.setVolume(1),this.muted=!1}stop(){this.masterInfo.songActive=!1,this.liveStream?this.ctx.suspend():this.setVolume(0),this.muted=!0}stopStream(){if(this.liveStream=!1,this.livePlayer&&(this.livePlayer.pause(),this.livePlayer=null),this.current)for(this.current.song.pause(),this.current.song=null,this.current=null;this.queue.length>0;)this.queue.shift()}}(oe,oe.songDelay),ue=new class{constructor(e,t){this.masterInfo=e,this.streamPlayer=t,this.radioAudio=new Audio,this.radioAudio.crossOrigin="anonymous",this.listening=!1,this.canceled=!1,this.chunksA=[],this.chunksB=[],this.times={A:0,B:0},this.timestamp=performance.now(),this.startTime=0,this.endTime=0,this.recorderA=null,this.recorderB=null,g().then((e=>{this.stations=e.stations,this.activateStationSelection()}))}updateStationInfo(e){this.stations=e;const t=document.getElementById("select-station");t.innerHTML="";const s=Object.keys(this.stations);for(let e=0;e<s.length;e++){const i=s[e],n=document.createElement("option");n.value=i,n.innerText=this.stations[i].name,e===s.length-1&&(this.stationInfo=this.stations[i],n.selected="selected"),t.appendChild(n)}}activateStationSelection(){document.getElementById("cancel-radio-connect").addEventListener("click",(()=>{this.canceled=!0,this.listening=!1,document.getElementById("radio-status-title").style.color="blue",document.getElementById("radio-status-title").innerText="Connecting...",document.getElementById("connecting-radio").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden")}));const e=document.getElementById("select-station");e.addEventListener("change",(()=>{const t=e.value;this.masterInfo.radioCode=t,this.stationInfo=this.stations[t],this.radioAudio.setAttribute("src",this.stationInfo.stream),document.getElementById("song-label").innerText=this.stationInfo.name,this.masterInfo.currentSong=this.stationInfo.name,this.stopListening(),this.streamPlayer.stop()}))}stopListening(){this.listening&&(this.streamPlayer.stopStream(),this.listening=!1)}startListening(){if(this.listening)return;this.listening=!0,this.canceled=!1,document.getElementById("acquiring").style.color="transparent",document.getElementById("initial-received").style.color="transparent",document.getElementById("now-streaming").style.color="transparent",document.getElementById("connecting-radio").classList.remove("hidden"),document.getElementById("connecting-radio").classList.add("menu"),document.getElementById("acquiring").style.color="gray";let e=!1;setTimeout((()=>{e||(this.canceled=!0,document.getElementById("radio-status-title").style.color="red",document.getElementById("radio-status-title").innerText="Connection failed")}),15e3);const t=new Audio(this.stationInfo.stream);t.crossOrigin="anonymous",t.addEventListener("canplaythrough",(()=>{if(!e&&!this.canceled){e=!0;const s=new AudioContext,i=s.createMediaElementSource(t),n=s.createDelay(1*this.masterInfo.songDelay/1e3);n.delayTime.setValueAtTime(1*this.masterInfo.songDelay/1e3,t.currentTime),i.connect(n),n.connect(s.destination);const a=new AudioContext,o=a.createMediaStreamSource(t.captureStream()),l=a.createAnalyser();o.connect(l),a.setSinkId({type:"none"}),l.connect(a.destination),l.fftSize=4096;const r=new Uint8Array(l.frequencyBinCount);this.streamPlayer.setData({liveStream:!0,player:t,analyser:l,dataArray:r,ctx:s,nowCtx:a})}}))}switchToB(){this.times.B=performance.now(),this.recorderB.start()}switchToA(){this.times.A=performance.now(),this.recorderA.start()}}(oe,me),ge=new class{constructor(){this.barPos=0}startBarAnimate(e,t){const s=e-this.barPos,i=performance.now()+t,n=t/500,a=s/Math.ceil(n),o=setInterval((()=>{d(this.barPos+a),this.barPos+=a,(performance.now()>i||this.barPos>e)&&clearInterval(o)}),500)}animateBar(){const e=performance.now();e>this.endTime&&(this.animating=!1);const t=e-this.lastTime,s=this.endTime>e?t/(this.endTime-e):0;console.log("this: "+s);const i=this.endPos-this.barPos,n=100*(this.barPos+s*i);d(n),this.barPos=n,this.lastTime=e,this.animating&&requestAnimationFrame((()=>{this.animateBar()}))}convertToM4a(e){return new Promise((t=>{this.startBarAnimate(25,2e3);const s=new Audio(`data:audio/x-wav;base64,${e}`);let i=!1;s.oncanplaythrough=()=>{if(!i){i=!0;const n=s.duration,a=Math.ceil(n/8);this.startBarAnimate(100,5e3+1e3*a),setTimeout((()=>{h("Keep your shirt on")}),15e3),setTimeout((()=>{h("m4a loads faster...")}),4e3);const o=Math.ceil(n/a),l=[];for(let e=0;e<o;e++)l.push(null);let r=0;for(let s=0;s<o;s++){const i=s*a,n=new Audio(`data:audio/x-wav;base64,${e}`);let h=!1;n.oncanplaythrough=()=>{if(!h){h=!0,n.currentTime=i;const e=new AudioContext,c=e.createMediaStreamDestination(),m=new MediaRecorder(c.stream),u=e.createMediaElementSource(n),g=[];u.connect(c),n.play();const A=n.currentTime;m.start(),setTimeout((()=>{m.stop(),n.pause()}),1e3*a),m.ondataavailable=e=>{g.push(e.data)},m.onstop=()=>{const i=new Blob(g,{type:"audio/ogg; codecs=opus"}),n=new FileReader;n.onload=i=>{const n=btoa(i.target.result),a=new Audio(`data:audio/x-wav;base64,${n}`),h=new AudioContext,c=h.createMediaElementSource(a),m=h.createAnalyser();c.connect(m),h.setSinkId({type:"none"}),m.connect(h.destination),m.fftSize=4096;const u=new Uint8Array(m.frequencyBinCount);let g=!1;a.oncanplaythrough=()=>{g||(e.close(),g=!0,l[s]={audio:a,startTime:A,analyser:m,array:u,ctx:h},r+=1,r===o&&(setTimeout((()=>{d(0),this.barPos=0}),500),t(l)))}},n.readAsBinaryString(i)}}}}}}}))}},Ae=new class{constructor(e,t,s,i){this.masterInfo=e,this.animator=t,this.noteWriter=s,this.addNote=i,this.runner=document.getElementById("flashy-stick-middle"),this.top=document.getElementById("flashy-stick-upper"),this.bottom=document.getElementById("flashy-stick-lower"),this.menus=["source-menu","main-menu","feedback","choose-song-menu"],document.getElementById("close-calibrator-button").addEventListener("click",(()=>{this.endCalibration(),this.masterInfo.tutorialAfterCalibrate&&(this.masterInfo.songMode="tutorial",this.masterInfo.tutorialAfterCalibrate=!1,this.masterInfo.startTutorial())})),document.getElementById("faster-button").addEventListener("click",(()=>{this.masterInfo.manualDelay+=1,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("slower-button").addEventListener("click",(()=>{this.masterInfo.manualDelay-=1,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("way-faster-button").addEventListener("click",(()=>{this.masterInfo.manualDelay+=25,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("way-slower-button").addEventListener("click",(()=>{this.masterInfo.manualDelay-=25,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`})),document.getElementById("calibrate-now").addEventListener("click",(()=>{document.getElementById("calibrate-popup").classList.add("hidden"),document.getElementById("calibrate-curtain").classList.add("hidden"),this.openCalibration(this.masterInfo.songMode)})),document.getElementById("skip-calibrate").addEventListener("click",(()=>{document.getElementById("calibrate-popup").classList.add("hidden"),document.getElementById("calibrate-curtain").classList.add("hidden"),this.masterInfo.tutorialAfterCalibrate&&(this.masterInfo.songMode="tutorial",this.masterInfo.tutorialAfterCalibrate=!1,this.masterInfo.startTutorial())})),document.getElementById("ok-big-calibrate").addEventListener("click",(()=>{document.getElementById("big-calibrate-popup").classList.add("hidden")})),this.toneAudio=new Audio,this.toneAudio.setAttribute("src","data:audio/x-wav;base64,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")}openCalibration(e){console.log(e),this.closed=!1,this.masterInfo.manualDelay>-1?document.getElementById("manual-delay-display").innerText=`+ ${this.masterInfo.manualDelay} ms`:document.getElementById("manual-delay-display").innerText=`- ${-1*this.masterInfo.manualDelay} ms`,o("settings"),this.makeMenusInvisible();const t=document.getElementById("calibrator");t.style.top="20%",t.style.left="5%",t.style.width="83vw",t.style.fontSize="5vw",t.style.overflow="hidden",t.classList.remove("hidden"),this.startCalibration()}animatePing(e){const t=1*e.currentTime/e.duration*100+.1/e.duration*this.masterInfo.manualDelay/2;this.runner.style.left=`${t}%`,t>47&&t<53?(this.runner.classList.add("flashy-stick-active"),this.top.classList.add("flashy-stick-active"),this.bottom.classList.add("flashy-stick-active")):(this.runner.classList.remove("flashy-stick-active"),this.top.classList.remove("flashy-stick-active"),this.bottom.classList.remove("flashy-stick-active")),t<99&&setTimeout((()=>{this.animatePing(e)}),1)}runPing(){this.toneAudio.play(),this.animating=!0,this.animatePing(this.toneAudio)}startCalibration(){this.calibrationInterval=setInterval((()=>{this.runPing()}),1e3)}endCalibration(){if(this.closed=!0,this.toneAudio.pause(),clearInterval(this.calibrationInterval),document.getElementById("calibrator").classList.add("hidden"),this.makeMenusVisible(),Math.abs(this.masterInfo.manualDelay)>150){const e=document.getElementById("big-calibrate-popup");e.style.top="20%",e.style.left="10vw",e.style.width="70vw",e.style.zIndex="20",e.classList.remove("hidden"),this.masterInfo.effects=!1,document.getElementById("toggle-effects-ball").classList.add("toggle-ball-off"),document.getElementById("effects-title").style.opacity="0.5"}this.masterInfo.promptedCalibration=!0}makeMenusInvisible(){this.menus.forEach((e=>{document.getElementById(e).style.zIndex="-20"}))}makeMenusVisible(){this.menus.forEach((e=>{document.getElementById(e).style.zIndex="5"}))}}(oe,de,re,Le),ye=new class{constructor(e,t,s,i,n,a,o,l){this.player=t,this.animator=i,this.fileConverter=n,this.noteWriter=a,this.calibrator=o,this.statsManager=l,this.masterInfo=e,this.streamPlayer=s,this.activateSongSelect(),this.activateSettings(),this.activateLevelSelector(),this.activateSlidesSelector((e=>{this.animator.setNumSlides(e)})),this.activateSongControls(),this.activateSongUpload()}activateSongSelect(e=!0){document.getElementById("stages").innerText="";const t={1:"Super easy",2:"Easy",3:"Medium",4:"Hard",5:"Crazy hard"},s={1:75,2:80,3:85,4:90,5:95};g().then((i=>{const n=`l${i.level}s${i.slides}`,o=s[i.level];document.getElementById("level-sub-title").innerText=`${t[i.level]} / ${i.slides} slides`;const l=i.progress[n],r=Object.keys(l);let d=!0,h=null;k.forEach(((e,t)=>{const s=document.createElement("div");s.classList.add("stage");const i=document.createElement("div");i.classList.add("stage-title"),i.innerText=t===k.length-1?"Bonus songs":`Stage ${t+1}`,s.appendChild(i),document.getElementById("stages").appendChild(s);let n=!0;e.forEach((e=>{const t=document.createElement("div");t.classList.add("song-title-container"),t.id=e;const i=document.createElement("div");i.classList.add("song-mark");const m=document.createElement("div");m.classList.add("song-title");const u=document.createElement("div");if(u.classList.add("song-score"),m.innerText=M[e],r.includes(e))if(u.innerText=`${l[e]}%`,l[e]<o){h||(h=e),u.classList.add("song-score-fail");const t=document.createElement("div");t.classList.add("red-x-a");const s=document.createElement("div");s.classList.add("red-x-b"),i.appendChild(t),i.appendChild(s),n=!1}else{const e=document.createElement("div");e.classList.add("green-check"),i.appendChild(e)}else n=!1,h||(h=e);t.appendChild(i),t.appendChild(m),t.appendChild(u),s.appendChild(t),d&&t.addEventListener("click",(()=>{this.masterInfo.audioLoaded=!1,document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))})),document.getElementById("choose-song-menu").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden"),document.getElementById("song-to-play").innerText=M[e],fetch(`./songStrings/${e}.txt`).then((t=>{t.text().then((t=>{this.masterInfo.currentSong=M[e],this.masterInfo.songCode=e,this.animator.stopAnimation(),this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${t}`),a("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(this.masterInfo,this.noteWriter)}))}))}))})),d||s.classList.add("stage-locked"),n||(d=!1)})),this.masterInfo.defaultSong=h,e&&h&&(this.masterInfo.songCode=h,document.getElementById("song-to-play").innerText=M[h],this.masterInfo.currentSong=M[h])}))}activateSongUpload(){let e=!1;document.getElementById("file-input").addEventListener("change",(t=>{this.player.pause(),this.animator.stopAnimation(),l(),document.getElementById("close-and-play").classList.add("hidden");const s=t.target.files[0];s||r();const i=new FileReader;i.onload=s=>{const i=btoa(s.target.result),n=t.target.files[0].name.split("");if(".m4a"===n.slice(n.length-4,n.length).join("")){const s=`data:audio/x-wav;base64,${i}`;if(!e){const t=new AudioContext,s=t.createMediaElementSource(this.player.song1);s.connect(t.destination);const i=t.createAnalyser();t.setSinkId({type:"none"}),s.connect(i),i.connect(t.destination),i.fftSize=4096;const n=new Uint8Array(i.frequencyBinCount);this.player.detailedAnalyser=i,this.player.detailedDataArray=n,e=!0}this.animator.stopAnimation(),this.player.pause(),this.player.setSource(s),a("button-play"),c(this.masterInfo,this.noteWriter),this.masterInfo.currentSong=t.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong,r(),document.getElementById("close-and-play").classList.remove("hidden")}else this.player.setSource(`data:audio/x-wav;base64,${i}`,!1,!1,!0),this.masterInfo.currentSong=t.target.files[0].name,document.getElementById("song-label").innerText=this.masterInfo.currentSong},i.readAsBinaryString(s)}))}activateSongControls(){document.getElementById("button-play").addEventListener("click",(()=>{this.playFunction(),document.getElementById("button-play").classList.remove("pulse"),document.getElementById("button-play-beacon").classList.add("hidden")})),document.getElementById("button-pause").addEventListener("click",(()=>{this.masterInfo.pauseDisabled||this.pauseFunction()})),document.getElementById("button-restart").addEventListener("click",(()=>{this.restartFunction()})),this.masterInfo.spaceFunction=()=>{this.playFunction()}}playFunction(){"stream"===this.masterInfo.songMode||"radio"===this.masterInfo.songMode?(this.streamPlayer.start(),this.animator.runAnimation({player:this.streamPlayer,algorithm:this.masterInfo.algorithm})):("demo"===this.masterInfo.songMode&&this.masterInfo.songCode&&(this.masterInfo.currentSong=M[this.masterInfo.songCode],document.getElementById("song-label").innerHTML=this.masterInfo.currentSong),this.player.start(),this.animator.runAnimation({player:this.player,algorithm:this.masterInfo.algorithm})),a("button-pause"),this.masterInfo.spaceFunction=()=>{this.pauseFunction()}}pauseFunction(){this.statsManager.updateInfo(),"stream"===this.masterInfo.songMode||"radio"===this.masterInfo.songMode?(this.streamPlayer.stop(),c(this.masterInfo,this.noteWriter)):this.player.pause(),this.animator.stopAnimation(),a("button-play"),this.masterInfo.spaceFunction=()=>{this.playFunction()}}restartFunction(){this.player.restart(),this.masterInfo.songNotesHit=0,this.masterInfo.songNotesMissed=0,this.masterInfo.songStreak=0,this.animator.stopAnimation(),a("button-play"),c(this.masterInfo,this.noteWriter),this.masterInfo.spaceFunction=()=>{this.playFunction()}}activateSlidesSelector(e){[["slides-2",2],["slides-3",3],["slides-4",4]].forEach((t=>{const s=document.getElementById(t[0]);s.addEventListener("click",(()=>{this.deselectSlides(),this.selectSlides(t[1],e),s.classList.add("level-selected")}))})),g().then((t=>{document.getElementById(`slides-${t.slides}`).classList.add("level-selected"),this.selectSlides(t.slides,e)}))}deselectSlides(){["slides-2","slides-3","slides-4"].forEach((e=>{document.getElementById(e).classList.remove("level-selected")}))}setWordsPos(e){const t=document.getElementById("streak-container"),s=document.getElementById("perfect-container");t.classList.remove("streak-container-2"),t.classList.remove("streak-container-3"),t.classList.remove("streak-container-4"),s.classList.remove("perfect-container-2"),s.classList.remove("perfect-container-3"),s.classList.remove("perfect-container-4"),t.classList.add(`streak-container-${e}`),s.classList.add(`perfect-container-${e}`)}selectSlides(e,t){this.setWordsPos(e);const s=document.getElementById("slide-a"),i=document.getElementById("slide-b"),n=document.getElementById("a-slide-a"),a=document.getElementById("a-slide-b"),o=document.getElementById("b-slide-a"),l=document.getElementById("b-slide-b"),r=document.getElementById("clear-slide-a"),d=document.getElementById("clear-slide-b"),h=document.getElementById("dummy-a"),c=document.getElementById("dummy-b"),m=document.getElementById("dummy-tapper-a-container"),A=document.getElementById("dummy-tapper-b-container"),y=document.getElementById("slides-container");2===e&&(t(2),s&&(s.classList.add("hidden"),i.classList.add("hidden")),n&&(n.classList.add("hidden"),a.classList.add("hidden")),o&&(o.classList.add("hidden"),l.classList.add("hidden")),r.classList.add("hidden"),d.classList.add("hidden"),h.classList.add("hidden"),c.classList.add("hidden"),m.classList.add("hidden"),A.classList.add("hidden"),y.classList.remove("three-wide-slides-container"),y.classList.remove("four-wide-slides-container")),3===e&&(t(3),document.getElementById("slides-container").classList.add("three-wide-slides-container"),s&&(s.classList.remove("hidden"),i.classList.add("hidden")),n&&(n.classList.remove("hidden"),a.classList.add("hidden")),o&&(o.classList.remove("hidden"),l.classList.add("hidden")),r.classList.remove("hidden"),d.classList.add("hidden"),h.classList.remove("hidden"),c.classList.add("hidden"),m.classList.remove("hidden"),A.classList.add("hidden"),y.classList.add("three-wide-slides-container"),y.classList.remove("four-wide-slides-container")),4===e&&(t(4),s&&(s.classList.remove("hidden"),i.classList.remove("hidden")),n&&(n.classList.remove("hidden"),a.classList.remove("hidden")),o&&(o.classList.remove("hidden"),l.classList.remove("hidden")),r.classList.remove("hidden"),d.classList.remove("hidden"),h.classList.remove("hidden"),c.classList.remove("hidden"),m.classList.remove("hidden"),A.classList.remove("hidden"),y.classList.remove("three-wide-slides-container"),y.classList.add("four-wide-slides-container"));const f={1:"Super easy",2:"Easy",3:"Medium",4:"Hard",5:"Crazy hard"};g().then((t=>{t.slides=e;const s=f[t.level];document.getElementById("current-difficulty").innerText=`${s} / ${t.slides} slides`,u().then((()=>{this.activateSongSelect(!1)}))}))}activateLevelSelector(){const t={1:"Super easy",2:"Easy",3:"Medium",4:"Hard",5:"Crazy hard"};[["level-1",1],["level-2",2],["level-3",3],["level-4",4],["level-5",5]].forEach((n=>{e(n[0],(()=>{["level-1","level-2","level-3","level-4","level-5"].forEach((e=>{i(e,"level-selected")})),this.animator.setNotesPerSecond(n[1]),s(n[0],"level-selected"),g().then((e=>{e.level=n[1];const s=t[e.level];document.getElementById("current-difficulty").innerText=`${s} / ${e.slides} slides`,u().then((()=>{this.activateSongSelect(!1)}))}))}))})),g().then((e=>{this.animator.setNotesPerSecond(e.level),s(`level-${e.level}`,"level-selected");const i=t[e.level];document.getElementById("current-difficulty").innerText=`${i} / ${e.slides} slides`}))}activateSettings(){document.getElementById("show-settings").addEventListener("click",(()=>{document.getElementById("settings-modal").classList.remove("hidden"),document.getElementById("modal-background").classList.remove("hidden")})),e("save-settings",(()=>{this.masterInfo.waitingForKey||o("settings")}));const s=[["change-left","left-key"],["change-a","a-key"],["change-b","b-key"],["change-right","right-key"]];for(let i=0;i<s.length;i++)t(s[i][1],this.masterInfo.tapperKeys[i]),e(s[i][0],(()=>{t(s[i][1],"-"),document.getElementById("change-key-message").innerText="press a key",document.getElementById("save-settings").style.opacity="0.5",this.masterInfo.waitingForKey=[s[i][1],i]}));[["toggle-background","animatedBackground","background-title"],["toggle-sustained","sustainedNotes","sustained-title"],["toggle-calibration","autoCalibrating","calibration-title"],["toggle-haptics","hapticsOnHit","haptics-title"],["toggle-animations","animations","animations-title"],["toggle-effects","effects","effects-title"],["toggle-double","double","double-title"]].forEach((e=>{document.getElementById(e[0]).addEventListener("click",(()=>{this.masterInfo[e[1]]?(this.masterInfo[e[1]]=!1,document.getElementById(`${e[0]}-ball`).classList.add("toggle-ball-off"),document.getElementById(e[2]).style.opacity="0.5","toggle-calibration"===e[0]&&(this.masterInfo.autoAdjustment=0)):(this.masterInfo[e[1]]=!0,document.getElementById(`${e[0]}-ball`).classList.remove("toggle-ball-off"),document.getElementById(e[2]).style.opacity="1"),g().then((t=>{t[e[1]]=this.masterInfo[e[1]],u()}))}))})),document.getElementById("open-calibration").addEventListener("click",(()=>{this.calibrator.openCalibration()}));const i=document.getElementById("reset-button"),n=document.getElementById("reset-checkbox");n.addEventListener("change",(()=>{n.checked?i.disabled=!1:i.disabled=!0}));const a=document.getElementById("select-sustained-frequency");a.addEventListener("change",(()=>{this.masterInfo.sustainedNotesFrequency=a.value,g().then((e=>{e.sustainedNotesFrequency=this.masterInfo.sustainedNotesFrequency,u()}))}));const l=document.getElementById("select-double-frequency");l.addEventListener("change",(()=>{this.masterInfo.doubleFrequency=l.value,g().then((e=>{e.doubleFrequency=this.masterInfo.doubleFrequency,u()}))}));const r=document.getElementById("algorithm-selector");r.addEventListener("change",(()=>{this.masterInfo.algorithm=r.value,g().then((e=>{e.algorithm=this.masterInfo.algorithm,u()})),document.getElementById("toggle-algorithm").innerHTML=this.masterInfo.algorithm}));const d=document.getElementById("animation-style-selector");d.addEventListener("change",(()=>{this.masterInfo.animationStyle=d.value,g().then((e=>{e.animationStyle=this.masterInfo.animationStyle,u()})),document.getElementById("toggle-animation-style").innerHTML={lightUp:"Light up",flyAway:"Fly away",both:"Both"}[this.masterInfo.animationStyle],"flyAway"===this.masterInfo.animationStyle||"both"===this.masterInfo.animationStyle?["bulb-left","bulb-a","bulb-b","bulb-right"].forEach((e=>{document.getElementById(e).classList.add("hidden")})):["bulb-left","bulb-a","bulb-b","bulb-right"].forEach((e=>{document.getElementById(e).classList.remove("hidden")}))}));const h=document.getElementById("speed-selector");h.addEventListener("change",(()=>{this.masterInfo.songDelay=parseInt(h.value);const e=1*this.masterInfo.travelLength/(this.masterInfo.songDelay-2e3)*this.masterInfo.targetTime;this.masterInfo.targetBounds.top=this.masterInfo.travelLength-e,this.masterInfo.targetBounds.bottom=this.masterInfo.travelLength+e,g().then((e=>{e.songDelay=this.masterInfo.songDelay,u()}));const t={6500:"super slow",5500:"slow",4700:"medium",4e3:"fast",3500:"crazy fast"}[h.value];document.getElementById("toggle-speed").innerHTML=t,this.restartFunction()})),i.addEventListener("click",(()=>{g().then((e=>{e.progress={l1s2:{},l1s3:{},l1s4:{},l2s2:{},l2s3:{},l2s4:{},l3s2:{},l3s3:{},l3s4:{},l4s2:{},l4s3:{},l4s4:{},l5s2:{},l5s3:{},l5s4:{}},e.stats={currentStreak:0,streakLevel:6,notesHitOnFire:0,rank:"groupie",streaks:{l1:0,l2:0,l3:0,l4:0,l5:0},accuracy:{l1:100,l2:100,l3:100,l4:100,l5:100},notesHit:{l1:0,l2:0,l3:0,l4:0,l5:0}},u(),i.disabled="disabled",n.checked=!1,this.activateSongSelect()}))}))}toggleFullscreen(){return new Promise((e=>{document.isFullscreen?document.exitFullscreen().then((()=>{e()})):document.getElementById("game-container").requestFullscreen().then((()=>{e()}))}))}recalculateLengths(){setTimeout((()=>{if(n()){const e=document.getElementById("game-container").clientHeight;this.masterInfo.travelLength=w.mobile.travelLength*e;const t=Math.floor(this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2));this.masterInfo.targetBounds.top=w.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=w.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=t,this.masterInfo.maxTailLength=1*w.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}else{const e=document.getElementById("game-container").clientHeight,t=document.getElementById("game-container").clientWidth;let s=Math.min(t,e);this.masterInfo.vMin=s,this.masterInfo.slideLength=1.5*s,this.masterInfo.travelLength=1.365*s;const i=1*this.masterInfo.travelLength/(this.masterInfo.songDelay/1e3/2);this.masterInfo.targetBounds.top=w.mobile.targetBounds.top*this.masterInfo.travelLength,this.masterInfo.targetBounds.bottom=w.mobile.targetBounds.bottom*this.masterInfo.travelLength,this.masterInfo.noteSpeed=i,this.masterInfo.maxTailLength=1*w.mobile.maxTailLength*this.masterInfo.travelLength,this.masterInfo.slideLength=1.3*this.masterInfo.travelLength}}),500)}}(oe,ce,me,de,ge,re,Ae,he);let fe=new L(oe,me,(function e(){fe=new L(oe,me,e),pe.connector=fe}));const pe=new class{constructor(e,t,s,i,n,a,o){this.masterInfo=e,this.controlsManager=t,this.stationManager=i,this.player=s,this.streamPlayer=n,this.noteWriter=a,this.connector=o,this.menus=["source-menu","main-menu","feedback","choose-song-menu","first-time-menu","stream-modal"],this.mainMenuOptions=["choose-song-button","upload-song-button","select-station-button","show-stream-modal-button"],this.activateMenuShowButtons(),this.activateSourceMenuButtons(),this.activateMainMenu(),this.activateDifficultyMenu(),this.activateFeedbackMenu(),this.activateGiveFeedbackMenu(),this.activateControlsDrag(),this.activateOtherControlsDrag(),this.hideMenus()}activateControlsDrag(){const e=document.getElementById("controls-bottom");let t=!1,s=0,i=0;const n=window.innerWidth,a=window.innerHeight;let o;e.addEventListener("touchstart",(n=>{o=setTimeout((()=>{t=!0;const a=e.getBoundingClientRect();s=n.targetTouches[0].clientX-a.left,i=n.targetTouches[0].clientY-a.top,e.style.opacity="1"}),500)})),e.addEventListener("touchend",(()=>{t=!1,clearTimeout(o),e.style.opacity="0.5"})),document.addEventListener("touchmove",(o=>{if(t){e.classList.remove("stuck-to-bottom");let t=o.changedTouches[0].clientX-s,l=o.changedTouches[0].clientY-i;const r=e.getBoundingClientRect();t<0&&(t=0),t>n-(r.right-r.left)&&(t=n-(r.right-r.left)),l<0&&(l=0),l>a-(r.bottom-r.top)&&(l=a-(r.bottom-r.top)),e.style.top=`${l}px`,e.style.left=`${t}px`,(o.changedTouches[0].clientX<.15*n||o.changedTouches[0].clientX>.85*n)&&e.classList.add("controls-vertical"),o.changedTouches[0].clientY>.85*a&&e.classList.remove("controls-vertical")}}))}activateOtherControlsDrag(){const e=document.getElementById("controls-top-left");let t=!1,s=0,i=0;const n=window.innerWidth,a=window.innerHeight;let o;e.addEventListener("touchstart",(n=>{o=setTimeout((()=>{t=!0;const a=e.getBoundingClientRect();s=n.targetTouches[0].clientX-a.left,i=n.targetTouches[0].clientY-a.top,e.style.opacity="1"}),500)})),e.addEventListener("touchend",(()=>{t=!1,clearTimeout(o),e.style.opacity="0.5"})),document.addEventListener("touchmove",(o=>{if(t){e.style.transform="translate(0%, 0%)";let t=o.changedTouches[0].clientX-s,l=o.changedTouches[0].clientY-i;const r=e.getBoundingClientRect();t<0&&(t=0),t>n-(r.right-r.left)&&(t=n-(r.right-r.left)),l<0&&(l=0),l>a-(r.bottom-r.top)&&(l=a-(r.bottom-r.top)),e.style.top=`${l}px`,e.style.left=`${t}px`}}))}activateGiveFeedbackMenu(){e("open-feedback-link",(()=>{document.userFeedbackOpen=!0,document.getElementById("give-feedback-modal").classList.remove("hidden"),document.getElementById("give-feedback-modal").classList.add("menu"),document.getElementById("modal-background").classList.remove("hidden"),document.getElementById("settings-modal").classList.add("hidden")})),e("cancel-give-feedback",(()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("modal-background").classList.add("hidden"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1})),e("submit-give-feedback",(()=>{const e=document.getElementById("feedback-message").value;if(e.length<3)alert("Cannot submit empty message!");else{document.getElementById("cancel-give-feedback").disabled="disabled",document.getElementById("submit-give-feedback").disabled="disabled";let t=document.getElementById("feedback-email").value;t.length<1&&(t="none"),fetch("https://beatburner.com/api/feedback.php",{method:"POST",body:JSON.stringify({message:e,email:t})}).then((()=>{document.getElementById("give-feedback-modal").innerHTML="Thanks!",setTimeout((()=>{document.getElementById("give-feedback-modal").classList.add("hidden"),document.getElementById("give-feedback-modal").classList.remove("menu"),document.getElementById("settings-modal").classList.remove("hidden"),document.userFeedbackOpen=!1}),1e3)}))}}))}activateFeedbackMenu(){e("replay",(()=>{document.getElementById("tutorial-step-10").classList.add("hidden"),document.getElementById("tutorial-step-11").classList.add("hidden"),this.player.restart(),this.controlsManager.playFunction(),this.hideMenus()})),document.getElementById("no-replay").addEventListener("click",(()=>{document.getElementById("tutorial-step-10").classList.add("hidden"),document.getElementById("tutorial-step-11").classList.add("hidden"),"demo"===this.masterInfo.songMode?this.showMenu("choose-song-menu"):this.showMenu("main-menu")}))}activateDifficultyMenu(){document.getElementById("close-difficulty").addEventListener("click",(()=>{document.getElementById("difficulty-menu").classList.add("hidden"),document.getElementById("main-menu").classList.remove("hidden")}))}activateMainMenu(){document.getElementById("choose-song-button").addEventListener("click",(()=>{document.getElementById("choose-song-menu").classList.remove("hidden"),document.getElementById("main-menu").classList.add("hidden")})),document.getElementById("change-difficulty-button").addEventListener("click",(()=>{document.getElementById("difficulty-menu").classList.remove("hidden"),document.getElementById("main-menu").classList.add("hidden")})),e("close-and-play",(()=>{this.hideMenus(),"radio"===this.masterInfo.songMode?this.stationManager.startListening():this.controlsManager.playFunction()}))}activateSourceMenuButtons(){e("source-demo-songs",(()=>{this.masterInfo.promptedCalibration||(m(),this.masterInfo.promptedCalibration=!0),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening();let e=!0;if("demo"===this.masterInfo.songMode&&(e=!1),this.masterInfo.canEnterCode=!1,this.masterInfo.songMode="demo",this.setMainMenuOption("choose-song-button"),e||!this.masterInfo.audioLoaded){document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.remove("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))}));let e=this.masterInfo.songCode;e||(e=this.masterInfo.defaultSong),e||(e="blahBlahBlah",document.getElementById("song-to-play").innerText=M.blahBlahBlah),fetch(`./songStrings/${e}.txt`).then((t=>{t.text().then((t=>{this.masterInfo.currentSong=M[e],this.masterInfo.songCode=e,this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${t}`),a("button-play"),document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(this.masterInfo,this.noteWriter)}))}))}else document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden");this.showMenu("main-menu")})),e("source-upload",(()=>{this.masterInfo.promptedCalibration||(m(),this.masterInfo.promptedCalibration=!0);let e=!0;"upload"===this.masterInfo.songMode&&(e=!1),this.masterInfo.canEnterCode=!1,this.masterInfo.songMode="upload",this.setMainMenuOption("upload-song-button"),e||!this.masterInfo.audioLoaded?(document.getElementById("close-and-play").classList.add("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.player.setPlayerReady((()=>{document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.audioLoaded=!0,this.player.setPlayerReady((()=>{}))}))):(document.getElementById("close-and-play").classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden")),this.showMenu("main-menu"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),e("source-radio",(()=>{this.masterInfo.promptedCalibration||(m(),this.masterInfo.promptedCalibration=!0),this.masterInfo.canEnterCode=!1,document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="radio",this.setMainMenuOption("select-station-button"),this.showMenu("main-menu"),this.masterInfo.currentSong="Hawk classic rock",document.getElementById("close-and-play").classList.remove("hidden")})),document.getElementById("source-streaming").addEventListener("click",(()=>{this.masterInfo.promptedCalibration||(m(),this.masterInfo.promptedCalibration=!0),this.masterInfo.canEnterCode=!1,document.getElementById("close-and-play-ghost").classList.add("hidden"),this.masterInfo.songMode="stream",this.setMainMenuOption("show-stream-modal-button"),document.getElementById("source-menu").classList.add("hidden"),document.getElementById("stream-modal").classList.remove("hidden"),"radio"===this.masterInfo.songMode&&this.stationManager.stopListening()})),document.getElementById("show-stream-modal-button").addEventListener("click",(()=>{document.getElementById("main-menu").classList.add("hidden"),document.getElementById("stream-modal").classList.remove("hidden")}))}setMainMenuOption(e){this.mainMenuOptions.forEach((e=>{document.getElementById(e).classList.add("hidden")})),document.getElementById(e).classList.remove("hidden")}activateMenuShowButtons(){document.getElementById("show-menu").addEventListener("click",(()=>{this.masterInfo.songMode&&"tutorial"!==this.masterInfo.songMode&&(this.showMenu("main-menu"),this.player.pause(),this.streamPlayer.stop(),this.player.countdownCanceled=!0)})),document.getElementById("show-source-menu").addEventListener("click",(()=>{this.masterInfo.canEnterCode=!0,c(this.masterInfo,this.noteWriter),document.getElementById("song-label").innerHTML="",this.masterInfo.currentSong="",this.showMenu("source-menu"),this.player.pause(),this.streamPlayer.stopStream(),this.stationManager.stopListening(),this.connector.closeConnection()})),document.getElementById("back-to-main-menu").addEventListener("click",(()=>{this.setMainMenuOption("choose-song-button"),this.showMenu("main-menu")})),document.getElementById("skip-tutorial-button").addEventListener("click",(()=>{this.showMenu("source-menu"),g().then((e=>{e.oldUser=!0,u()}))}))}showMenu(e){if(this.hideMenus(),document.getElementById(e).classList.remove("hidden"),"choose-song-menu"===e&&this.masterInfo.extendedTutorial){const e=document.getElementById("tutorial-step-12");e.style.top="10vh",e.style.left="6vh",e.style.zIndex=2e3,e.style.opacity=1,e.classList.remove("hidden")}if("main-menu"===e&&this.masterInfo.extendedTutorial){const e=document.getElementById("tutorial-step-13");e.style.top="30vh",e.style.left="6vh",e.style.zIndex=2e3,e.style.opacity=1,e.classList.remove("hidden");const t=document.getElementById("change-difficulty-button").getBoundingClientRect().bottom,s=document.getElementById("tutorial-arrow");s.style.top=`${t}px`,s.style.left="46vw",s.style.transform="rotate(0deg) translate(0vh, 3vh)",s.classList.remove("hidden"),document.getElementById("close-and-play-ghost").classList.add("hidden")}}hideMenus(){this.menus.forEach((e=>{document.getElementById(e).classList.add("hidden")}))}}(oe,ye,ce,ue,me,re,fe),Ie=new class{constructor(e,t,s,i,n,a,o){this.masterInfo=e,this.controlsManager=t,this.animator=s,this.player=i,this.noteWriter=n,this.menuManager=a,this.addNote=o,this.playing=!1,this.playingSong=!1,this.nextNoteIdx=0,this.releaseTime=0,this.notesHit=0,this.notesMissed=0,this.activateTutorial(),this.songNotes=[[2.46194,"slide-left"],[2.93213,"slide-left"],[3.261772,"slide-left"],[4.071073,"slide-left"],[4.888844,"slide-left"],[5.451498,"slide-left"],[6.268138,"slide-a"],[6.987352,"slide-a"],[8.352035,"slide-right"],[8.825848,"slide-right"],[9.208735,"slide-right"],[9.891026,"slide-right"],[10.621651,"slide-a"],[11.383086,"slide-left"],[12.181558,"slide-left"],[12.771304,"slide-left"],[13.58432,"slide-a"],[14.199451,"slide-a"],[14.686029,"slide-a"],[15.077,"slide-right"],[15.675686,"slide-right"],[16.119929,"slide-left"],[16.508924,"slide-left"],[17.253228,"slide-left"],[17.677042,"slide-right"],[18.665896,"slide-a"],[19.041213,"slide-right"],[19.408597,"slide-left"],[20.096563,"slide-right"],[20.551235,"slide-left"],[20.879712,"slide-right"],[21.570719,"slide-left"],[22.017696,"slide-a"],[22.403017,"slide-left"],[23.010386,"slide-a"],[23.477792,"slide-a"],[23.80235,"slide-left"],[24.520093,"slide-a"],[24.961103,"slide-a"],[25.335092,"slide-left"],[25.880481,"slide-right"],[26.416421,"slide-right"],[26.818142,"slide-a"],[27.329045,"slide-left"],[27.839089,"slide-left"],[28.193594,"slide-left"],[28.977664,"slide-left"],[29.383244,"slide-right"],[29.722685,"slide-a"],[30.819628,"slide-a"],[31.119825,"slide-left"],[31.876483,"slide-right"],[32.269131,"slide-right"],[32.636287,"slide-left"],[33.258386,"slide-a"],[33.687021,"slide-right"],[34.102092,"slide-right"],[34.637631,"slide-a"],[35.202356,"slide-right"],[35.543482,"slide-right"],[36.229869,"slide-a"],[36.702039,"slide-a"],[37.002433,"slide-a"],[37.59896,"slide-left"],[38.152062,"slide-a"],[38.480706,"slide-a"],[39.166,"slide-left"],[39.60085,"slide-right"],[39.903795,"slide-left"],[40.711821,"slide-left"],[41.138345,"slide-left"],[42.049796,"slide-left"],[42.477504,"slide-left"],[43.436948,"slide-right"],[43.977588,"slide-a"],[44.30976,"slide-right"],[45.458284,"slide-left"],[46.470486,"slide-right"],[46.898406,"slide-left"],[47.236151,"slide-a"],[47.911318,"slide-left"],[48.355652,"slide-a"],[48.711462,"slide-left"],[49.265738,"slide-a"],[49.816343,"slide-left"],[50.205555,"slide-right"],[50.83423,"slide-right"],[51.633747,"slide-left"],[52.34084,"slide-a"],[52.785104,"slide-left"],[54.200097,"slide-left"],[54.569704,"slide-left"],[55.23889,"slide-left"],[55.723891,"slide-left"],[56.055633,"slide-left"],[56.578485,"slide-left"],[57.156046,"slide-right"],[58.092507,"slide-a"],[58.647402,"slide-right"],[58.963944,"slide-left"],[59.704233,"slide-left"],[60.130858,"slide-left"],[61.056442,"slide-left"],[61.528066,"slide-right"],[61.891473,"slide-left"],[62.454313,"slide-left"],[62.966183,"slide-left"],[63.365505,"slide-left"],[64.106267,"slide-left"],[64.489571,"slide-left"],[64.829666,"slide-left"],[65.956729,"slide-left"],[66.322777,"slide-left"],[67.370048,"slide-right"],[67.733991,"slide-a"],[68.460176,"slide-right"],[68.869097,"slide-right"],[69.224845,"slide-right"],[69.890504,"slide-a"],[70.331709,"slide-a"],[70.683683,"slide-right"],[71.376449,"slide-a"],[71.751753,"slide-left"],[72.123742,"slide-a"],[73.220055,"slide-right"],[73.581908,"slide-a"],[74.236397,"slide-left"],[74.777472,"slide-right"],[75.711161,"slide-a"],[76.198607,"slide-a"],[76.527807,"slide-left"],[77.123927,"slide-left"],[77.593554,"slide-a"],[77.925786,"slide-left"],[78.625694,"slide-left"],[79.083081,"slide-right"],[79.448487,"slide-right"],[80.062396,"slide-right"],[80.539922,"slide-right"],[80.865434,"slide-left"],[81.477818,"slide-right"],[81.971707,"slide-left"],[82.390223,"slide-left"],[83.086038,"slide-left"],[83.469737,"slide-left"],[83.819914,"slide-a"],[84.5346,"slide-left"],[84.934407,"slide-right"],[85.837949,"slide-right"],[86.452148,"slide-left"],[87.06509,"slide-left"],[87.391524,"slide-right"],[87.88303,"slide-a"],[88.293713,"slide-left"],[88.8714,"slide-a"],[89.316545,"slide-left"],[89.715283,"slide-left"],[90.211734,"slide-left"],[90.820264,"slide-right"],[91.190637,"slide-right"],[91.76351,"slide-right"],[92.254535,"slide-a"],[92.651679,"slide-a"],[93.21941,"slide-right"],[93.735028,"slide-a"],[94.053814,"slide-left"],[94.759652,"slide-right"],[95.243925,"slide-a"],[95.576649,"slide-left"],[96.202458,"slide-left"],[96.640634,"slide-a"],[97.023522,"slide-left"],[97.714649,"slide-left"],[99.62146,"slide-left"],[99.938512,"slide-a"],[100.508893,"slide-left"],[100.999325,"slide-left"],[101.302508,"slide-left"],[101.984086,"slide-right"],[102.821043,"slide-left"],[103.535615,"slide-left"],[104.015683,"slide-left"],[104.353905,"slide-left"],[105.022819,"slide-left"],[105.423756,"slide-left"],[105.785448,"slide-a"],[106.523045,"slide-a"],[106.899581,"slide-right"],[107.237517,"slide-left"],[107.901745,"slide-left"],[108.323757,"slide-left"],[108.703916,"slide-right"],[109.361246,"slide-left"],[109.800983,"slide-a"],[110.244485,"slide-left"],[110.869287,"slide-right"],[111.310829,"slide-left"],[111.63546,"slide-left"],[112.326915,"slide-left"],[112.691335,"slide-left"],[113.091933,"slide-a"],[113.810393,"slide-a"],[114.208271,"slide-left"]],this.discoNotes=[[1.19,"slide-right"],[1.922975,"slide-right"],[2.64964,"slide-right"],[3.377775,"slide-right"],[4.146296,"slide-a"],[4.872564,"slide-right"],[5.634179,"slide-a"],[6.408622,"slide-right"],[7.138499,"slide-a"],[7.874535,"slide-right"],[8.258339,"slide-a"],[8.63395,"slide-left"],[8.977888,"slide-a"],[9.371591,"slide-right"],[9.746593,"slide-a"],[10.138783,"slide-left"],[10.498193,"slide-right"],[10.842692,"slide-a"],[11.218358,"slide-left"],[11.609946,"slide-right"],[12.010881,"slide-a"],[12.392757,"slide-left"],[13.170044,"slide-right"],[13.174042,"slide-left"],[13.531695,"slide-right"],[13.534294,"slide-left"],[13.912671,"slide-a"],[14.249677,"slide-right"],[14.254705,"slide-left"],[14.650833,"slide-left"],[14.654185,"slide-right"],[15.017858,"slide-right"],[15.030018,"slide-left"],[15.387001,"slide-left"],[15.390133,"slide-right"],[15.738058,"slide-a"],[16.146802,"slide-right"],[16.147137,"slide-left"],[16.489328,"slide-right"],[16.494338,"slide-left"],[16.857548,"slide-right"],[16.862264,"slide-left"],[17.193792,"slide-a"],[17.5948,"slide-a"],[17.986405,"slide-a"],[18.329925,"slide-right"],[18.738044,"slide-left"],[19.12176,"slide-a"],[19.483749,"slide-right"],[19.874464,"slide-left"],[20.232436,"slide-a"],[20.610403,"slide-right"],[20.970376,"slide-left"],[21.361784,"slide-a"],[21.722043,"slide-right"],[22.121884,"slide-left"],[22.499471,"slide-a"],[22.842589,"slide-right"],[23.218096,"slide-left"],[23.602082,"slide-a"],[23.784487,"slide-right"],[23.951953,"slide-left"],[24.193287,"slide-a"],[24.369036,"slide-right"],[24.551924,"slide-left"],[24.768837,"slide-a"],[25.146323,"slide-right"],[25.150288,"slide-left"],[25.511269,"slide-left"],[25.517514,"slide-right"],[25.87464,"slide-left"],[25.878253,"slide-right"],[26.234565,"slide-a"],[26.610134,"slide-right"],[26.610444,"slide-left"],[27.010181,"slide-right"],[27.014541,"slide-left"],[27.361866,"slide-a"],[28.154237,"slide-right"],[28.497921,"slide-a"],[28.891411,"slide-left"],[29.25036,"slide-a"],[29.634488,"slide-right"],[30.009608,"slide-a"],[30.362295,"slide-left"],[31.136506,"slide-a"],[31.52254,"slide-right"],[31.897354,"slide-left"],[32.264439,"slide-a"],[32.648243,"slide-right"],[32.993442,"slide-left"],[33.345854,"slide-a"],[34.13925,"slide-right"],[34.519922,"slide-a"],[34.907673,"slide-left"],[35.257546,"slide-a"],[35.611168,"slide-right"],[35.986129,"slide-left"],[36.200561,"slide-a"],[36.400863,"slide-right"],[37.178502,"slide-a"],[37.530883,"slide-a"],[37.906575,"slide-a"],[38.225291,"slide-right"],[38.247843,"slide-left"],[38.626289,"slide-a"],[39.002181,"slide-a"],[39.346522,"slide-right"],[39.350585,"slide-left"],[40.122632,"slide-right"],[40.520381,"slide-a"],[40.882019,"slide-left"],[41.234331,"slide-a"],[41.602364,"slide-right"],[42.018461,"slide-left"],[42.376155,"slide-a"],[43.122075,"slide-left"],[43.536439,"slide-right"],[43.906681,"slide-a"],[44.241316,"slide-left"],[44.62633,"slide-right"],[45.01045,"slide-a"],[45.361377,"slide-left"],[46.152597,"slide-right"],[46.506386,"slide-a"],[46.858254,"slide-left"],[47.225891,"slide-a"],[47.624301,"slide-right"],[47.977508,"slide-left"],[48.178056,"slide-a"],[48.352211,"slide-right"],[49.146588,"slide-a"],[49.505543,"slide-a"],[49.906918,"slide-a"],[50.275103,"slide-a"],[50.651123,"slide-a"],[51.010337,"slide-a"],[51.346576,"slide-right"],[51.364152,"slide-left"],[52.114427,"slide-a"],[52.508613,"slide-a"],[52.866701,"slide-a"],[53.266569,"slide-a"],[53.593583,"slide-a"],[53.976023,"slide-a"],[54.313979,"slide-right"],[54.334786,"slide-left"]]}activateTutorial(){[10,11,12,13].forEach((e=>{10===e?document.getElementById(`close-tutorial-${e}`).addEventListener("click",(()=>{document.getElementById(`tutorial-step-${e}`).classList.add("hidden");const t=document.getElementById("tutorial-step-11");t.style.top="5vh",t.style.left="6vh",t.style.zIndex=2e3,t.classList.remove("hidden")})):13===e?document.getElementById(`close-tutorial-${e}`).addEventListener("click",(()=>{document.getElementById(`tutorial-step-${e}`).classList.add("hidden"),document.getElementById("tutorial-arrow").classList.add("hidden"),this.masterInfo.extendedTutorial=!1})):document.getElementById(`close-tutorial-${e}`).addEventListener("click",(()=>{document.getElementById(`tutorial-step-${e}`).classList.add("hidden")}))})),document.getElementById("source-tutorial").addEventListener("click",(()=>{document.getElementById("source-menu").classList.add("hidden"),document.getElementById("close-tutorial").classList.remove("hidden"),this.startTutorial()})),document.getElementById("start-tutorial-button").addEventListener("click",(()=>{document.getElementById("first-time-menu").classList.add("hidden"),document.getElementById("close-tutorial").classList.remove("hidden"),this.startTutorial()})),document.getElementById("close-tutorial").addEventListener("click",(()=>{this.exitTutorial()})),[3,4,6,8,9].forEach((e=>{document.getElementById(`tutorial-${e}-button`).addEventListener("click",(()=>{this.triggerTutorialStep(e)}))})),document.getElementById("repeat-tutorial-song-button").addEventListener("click",(()=>{document.getElementById("tutorial-step-7").classList.add("hidden"),this.triggerTutorialStep(6)})),document.getElementById("tap-smudge").addEventListener("click",(()=>{this.triggerTutorialStep(4)}))}triggerTutorialStep(e){const t=document.getElementById("tutorial-arrow");if(1===e){this.exited=!1;const e=document.getElementById("tutorial-step-1");e.style.top="20vh",e.style.left="2vh",e.classList.remove("hidden"),this.animator.runAnimation(),this.addNote("slide-left",50),setTimeout((()=>{this.exited||this.addNote("slide-right",50)}),800),setTimeout((()=>{this.exited||(this.addNote("slide-a",50),setTimeout((()=>{this.exited||(this.animator.stopAnimation(!0),this.triggerTutorialStep(2))}),this.masterInfo.songDelay-2010))}),1500)}if(2===e){const e=document.getElementById("tutorial-step-2");e.style.top="45vh",e.style.left="2vh",e.classList.remove("hidden"),t.style.top="65vh",t.style.left="65vw",t.style.transform="rotate(270deg)",t.classList.remove("hidden")}if(3===e){t.style.top="74vh",t.style.left="62vw",t.style.transform="rotate(225deg)",t.classList.remove("hidden"),document.getElementById("tap-smudge").classList.remove("hidden"),document.getElementById("tutorial-step-1").classList.add("hidden"),document.getElementById("tutorial-step-2").classList.add("hidden");const e=document.getElementById("tutorial-step-3");e.style.top="50vh",e.style.left="2vh",e.style.width="75vw",e.classList.remove("hidden")}if(4===e&&(document.getElementById("tap-smudge").classList.add("hidden"),document.getElementById("tutorial-step-3").classList.add("hidden"),t.classList.add("hidden"),this.discoAudio=new Audio,fetch("./songStrings/discoBeat.txt").then((e=>{e.text().then((e=>{this.discoAudio.setAttribute("src",`data:audio/x-wav;base64,${e}`)}))})),this.discoAudio.addEventListener("ended",(()=>{this.playing=!1,this.masterInfo.streak<10&&(this.discoAudio.currentTime=0,this.nextNoteIdx=0,this.discoAudio.play(),this.animateDisco(this.discoAudio,this.discoNotes))})),this.masterInfo.streak=0,this.animator.runAnimation(),this.playing=!0,this.beatInterval=setInterval((()=>{const e=["slide-left","slide-a","slide-right"][Math.floor(3*Math.random())];this.addNote(e),this.releaseTime=performance.now(),this.masterInfo.streak>6&&!this.exited&&(clearInterval(this.beatInterval),this.playing=!1,setTimeout((()=>{document.getElementById("rock-label").innerHTML="Match <br> the <br> beat"}),2500),setTimeout((()=>{document.getElementById("rock-label").innerHTML=""}),5e3),this.masterInfo.streak=0,this.playingSong=!0,this.discoAudio.currentTime=1,this.discoAudio.volume=0,this.discoAudio.play(),this.animateDisco(this.discoAudio,this.discoNotes))}),1e3)),5===e){document.getElementById("rock-label").innerHTML="";const e=document.getElementById("tutorial-step-5");e.style.top="2vh",e.style.left="40vw",e.style.width="50vw",e.classList.remove("hidden")}if(6===e){this.discoAudio&&(this.discoAudio.pause(),this.discoAudio.currentTime=0),c(this.masterInfo,this.noteWriter),this.playingSong=!1,document.getElementById("tutorial-step-5").classList.add("hidden"),this.songAudio=new Audio,this.animator.runAnimation();let e=!1;this.songAudio.oncanplaythrough=()=>{e||(e=!0,this.notesHit=0,this.notesMissed=0,this.nextNoteIdx=0,this.player.countdown(),setTimeout((()=>{this.exited||(this.playingRealSong=!0,this.playing=!1,this.songAudio.play(),this.animateNotes(this.songAudio,this.songNotes))}),3e3))},this.songAudio.addEventListener("ended",(()=>{this.playingSong=!1,this.animator.stopAnimation();const e=Math.floor(100*this.notesHit/(this.songNotes.length+this.notesMissed));let t=`Nice job! You had an accuracy of ${e}%`;e<90?(t=`Hey, not bad. Your accuracy was ${e}%. Want to retry and go for ${Math.min(90,e+20)}%?`,e<60&&(t=`Your accuracy was ${e}%. I bet you can do better.`)):document.getElementById("repeat-tutorial-song-button").classList.add("hidden"),document.getElementById("step-7-text").innerHTML=t;const s=document.getElementById("tutorial-step-7");s.style.top="20vh",s.style.left="2vh",s.style.width="60vw",s.classList.remove("hidden")})),fetch("./songStrings/shareLove.txt").then((e=>{e.text().then((e=>{this.songAudio.setAttribute("src",`data:audio/x-wav;base64,${e}`)}))}))}if(8===e){document.getElementById("tutorial-step-7").classList.add("hidden");const e=document.getElementById("tutorial-step-8");e.style.top="20vh",e.style.left="30vw",e.style.width="55vw",e.classList.remove("hidden")}9===e&&(document.getElementById("tutorial-step-8").classList.add("hidden"),this.exitTutorial(),this.startExtendedTutorial())}animateNotes(e,t){const s=(1*this.masterInfo.songDelay-4e3)/1e3;if(this.playingRealSong){const i=e.currentTime+2;let n=t[this.nextNoteIdx];if(void 0!==n){for(;n[0]<i+s;){if(this.addNote(n[1],50,!1,this.masterInfo.manualDelay),this.nextNoteIdx+=1,this.nextNoteIdx>t.length-1)return;n=t[this.nextNoteIdx]}requestAnimationFrame((()=>this.animateNotes(e,t)))}}}animateDisco(e,t){const s=(1*this.masterInfo.songDelay-4e3)/1e3;if(this.playingSong){if(this.masterInfo.streak>10&&this.triggerTutorialStep(5),e.volume<1){const t=(e.currentTime-1)/6;e.volume=Math.min(t,1)}const i=e.currentTime-3.83;let n=t[this.nextNoteIdx];if(void 0!==n){for(;n[0]<i+s;){if(this.addNote(n[1],50,!1,this.masterInfo.manualDelay),this.releaseTime=performance.now(),this.nextNoteIdx+=1,this.nextNoteIdx>t.length-1)return;n=t[this.nextNoteIdx]}requestAnimationFrame((()=>this.animateDisco(e,t)))}}}triggerNoteAttempt(e){const t=document.getElementById("rock-label");if(t.classList.add("static-rock"),(this.playingSong||this.playingRealSong)&&(e?this.notesHit+=1:this.notesMissed+=1),this.playing){const s=performance.now()-this.releaseTime;e?(t.innerHTML="NICE!",setTimeout((()=>{t.innerHTML=""}),500)):(s<1e3&&s>750&&(t.innerHTML="bit <br> early",setTimeout((()=>{t.innerHTML=""}),500)),s>0&&s<250&&(t.innerHTML="bit <br> late",setTimeout((()=>{t.innerHTML=""}),500)))}}startTutorial(){const e={1:"Super easy",2:"Easy",3:"Medium",4:"Hard",5:"Crazy hard"};this.exited=!1,this.masterInfo.promptedCalibration?(this.masterInfo.songMode="tutorial",document.getElementById("controls-bottom").classList.add("hidden"),this.controlsManager.deselectSlides(),this.controlsManager.selectSlides(3,(e=>{this.animator.setNumSlides(e)})),document.getElementById("slides-3").classList.add("level-selected"),this.animator.setNumSlides(3),g().then((t=>{t.level=1;const s=e[t.level];t.slides=3;const i=`${s} / ${t.slides} slides`;document.getElementById("current-difficulty").innerText=i,document.getElementById("level-sub-title").innerText=i,u()})),this.triggerTutorialStep(1),this.masterInfo.autoCalibrating=!1):(m(),this.masterInfo.promptedCalibration=!0,this.masterInfo.tutorialAfterCalibrate=!0)}exitTutorial(){this.exited=!0,this.nextNoteIdx=0,this.discoAudio&&(this.discoAudio.pause(),this.discoAudio.currentTime=0),this.songAudio&&(this.songAudio.pause(),this.songAudio.currentTime=0),document.getElementById("tap-smudge").classList.add("hidden"),document.getElementById("source-menu").classList.remove("hidden"),document.getElementById("controls-bottom").classList.remove("hidden"),["close-tutorial","tutorial-arrow","tutorial-step-1","tutorial-step-2","tutorial-step-3","tutorial-step-5","tutorial-step-7","tutorial-step-8"].forEach((e=>{document.getElementById(e).classList.add("hidden")})),this.animator.stopAnimation(),setTimeout((()=>{document.getElementById("rock-label").classList.remove("static-rock"),clearInterval(this.beatInterval),this.playingSong=!1,this.playing=!1,c(this.masterInfo,this.noteWriter),this.masterInfo.extendedTutorial||(this.masterInfo.songMode=void 0),g().then((e=>{this.masterInfo.autoCalibrating=e.autoCalibrating}))}),300),g().then((e=>{e.level=1,this.animator.setNotesPerSecond(e.level),["level-1","level-2","level-3","level-4","level-5"].forEach((e=>{document.getElementById(e).classList.remove("level-selected")})),document.getElementById("level-1").classList.add("level-selected"),this.controlsManager.activateSongSelect(),u()})),g().then((e=>{e.oldUser=!0,u()}))}startExtendedTutorial(){l(),this.menuManager.setMainMenuOption("choose-song-button"),this.masterInfo.extendedTutorial=!0,this.masterInfo.hideAllMenus(),this.masterInfo.songMode="demo";const e="blahBlahBlah";fetch(`./songStrings/${e}.txt`).then((t=>{t.text().then((t=>{this.masterInfo.currentSong=M[e],this.masterInfo.songCode=e,this.animator.stopAnimation(),this.player.pause(),this.player.setSource(`data:audio/x-wav;base64,${t}`),document.getElementById("song-label").innerText=this.masterInfo.currentSong,c(this.masterInfo,this.noteWriter),setTimeout((()=>{this.controlsManager.playFunction(),r()}),100)}))}))}}(oe,ye,de,ce,re,pe,Le);function Be(e){document.getElementById(e).style.backgroundColor="rgba(168,0,93,0.2)",ne[e]=!1;const t={"tapper-left":"slide-left","tapper-a":"slide-a","tapper-b":"slide-b","tapper-right":"slide-right"},s=se[t[e]];s&&(se[t[e]]=null,s.height>.1*W&&ce.setVolume(.3),s.note.remove(),ee[t[e]]=null);const i=document.getElementById(`${t[e]}-flash-sustain`);i&&i.remove()}function ve(e,t,s){if(oe.canEnterCode&&function(e){if(e===Pe[He]){if(He+=1,!Pe[He]){const e={};["l1s2","l1s3","l1s4","l2s2","l2s3","l2s4","l3s2","l3s3","l3s4","l4s2","l4s3","l4s4","l5s2","l5s3","l5s4"].forEach((t=>{const s={};k.forEach((e=>{e.forEach((e=>{s[e]=90}))})),e[t]=s})),g().then((t=>{t.progress=e,u().then((()=>{ye.activateSongSelect(!1)}))}))}}else He=0}(t),!oe.songActive&&"tutorial"!==oe.songMode)return;ne[e]=!0;let i=5e3,n=0,a=null;if(_.forEach((e=>{if(t===e.slideId){const t=e.position-oe.travelLength;Math.abs(t)<i&&(a=e,i=t,t<80&&(n+=1))}})),oe.autoCalibrating){const e=.1*oe.travelLength,t=.1*oe.travelLength;1===n&&Math.abs(i)<e&&(oe.autoAdjustment+=i/(10*_.size)*1,oe.autoAdjustment=Math.max(oe.autoAdjustment,-1*t),oe.autoAdjustment=Math.min(oe.autoAdjustment,1*t))}const o=te[t];if(0===o.size&&Me(),o.has(a)){_.delete(a),a.note.remove(),a.note.classList.add(s),te[t].delete(a);let i=!1;if(a.tail){i=!0,se[t]=a.tail,a.tail.note.classList.add("tail-active"),a.tail.cloud.classList.remove("hidden");const s=document.createElement("div");s.classList.add("note-lighted");const n=document.createElement("div");n.classList.add("note-middle-lighted");const o=document.createElement("div");o.appendChild(s),o.appendChild(n),document.getElementById(`dummy-${e}`).appendChild(o),o.classList.add("flash-sustain"),o.id=`${t}-flash-sustain`;const l=oe.travelLength-a.tail.position;a.tail.note.style.height=`${l}px`,a.tail.height=l}!function(e,t,s){"tutorial"!==oe.songMode&&he.recordNoteHit(de.notesPerSecond,oe.onFire);const i=Te[de.notesPerSecond],n=we[de.notesPerSecond];oe.hapticsOnHit,oe.streaming?me.setVolume(1):"radio"!==oe.songMode&&ce.setVolume(1);const a={"slide-left":"smudge-left","slide-a":"smudge-a","slide-b":"smudge-b","slide-right":"smudge-right"}[e];if(document.getElementById(a).classList.remove("smudge-active"),s||("flyAway"===oe.animationStyle?H(e,t,de.slides.length):("lightUp"===oe.animationStyle||H(e,t,de.slides.length),function(e,t){const s=document.createElement("div");s.classList.add("note-lighted");const i=document.createElement("div");i.classList.add("note-middle-lighted");const n=document.createElement("div");n.id=`${e}-flash`,n.appendChild(s),n.appendChild(i),document.getElementById(`dummy-${t}`).appendChild(n),n.classList.add("flash"),setTimeout((()=>{n.remove()}),1e3)}(e,t))),de.recordNoteHit(),oe.streak+=1,oe.songStreak+=1,oe.streak<i+1){const e=document.createElement("div");e.classList.add(n),document.getElementById("streak-channel").appendChild(e)}if(oe.songNotesHit+=1,"tutorial"!==oe.songMode){const e=document.getElementById("rock-label");oe.streak>i&&(document.getElementById("streak-number").innerHTML=oe.streak),oe.streak===i&&(document.getElementById("streak-container").classList.remove("hidden"),oe.animations&&document.getElementById("streak-container").classList.add("bulge"),document.getElementById("streak-number").innerHTML=oe.streak,document.getElementById("streak-channel").classList.add("streak-channel-lit"),document.getElementById("streak-meter").classList.add("streak-meter-lit")),200===oe.streak&&(document.getElementById("slides").classList.add("on-fire"),e.innerHTML="ON FIRE!",e.classList.add("rock-label"),oe.onFire=!0,Se=!0,setTimeout((()=>{e.classList.remove("rock-label"),e.innerHTML="",Se=!1}),1300)),oe.streak>200&&(Se||(e.classList.add("static-rock"),e.innerText=oe.streak)),1e3===oe.streak&&(e.innerHTML="HOLY<br>SHIT!",Se=!0,setTimeout((()=>{Se=!1}),2e3))}}(t,e,i),"tutorial"===oe.songMode&&Ie.triggerNoteAttempt(!0)}else"tutorial"===oe.songMode&&Ie.triggerNoteAttempt(!1)}function Ee(e,t){if(t.isTail){const e=-0,s=t.position-e;t.totalHeight=t.totalHeight+s;const i=t.height+s;return t.note.style.height=`${i}px`,t.note.style.top=e-oe.sliderPos+"px",t.height=i,t.position=e,t}{const s=document.createElement("div");s.classList.add("note-tail");const i=-0;s.style.top=`${-1*oe.sliderPos+i}px`;const n=t.position-i;s.style.height=`${n}px`;const a=document.createElement("div"),o={note:s,position:i,height:n,totalHeight:n,slideId:e,target:!1,val:t.val,isTail:!0,cloud:a,parentNote:t,tail:null};return t.tail=o,a.classList.add("cloud-tail"),a.classList.add("hidden"),s.appendChild(a),document.getElementById(e).appendChild(s),ee[e]=o,o}}oe.startTutorial=()=>{Ie.startTutorial()},oe.hideAllMenus=()=>{pe.hideMenus()},document.isFullscreen=!1,document.wantFullscreenReturn=!1,a("button-play"),document.userFeedbackOpen=!1,document.addEventListener("keypress",(e=>{if(!document.userFeedbackOpen){if(e.stopPropagation(),oe.waitingForKey){e.preventDefault(),ie[oe.waitingForKey[1]]=e.code,document.getElementById(oe.waitingForKey[0]).innerText=e.code;const t=`bulb-${oe.waitingForKey[0].split("").slice(0,oe.waitingForKey[0].length-4).join("")}`;document.getElementById(t).innerText=e.code;const s=`inset-${oe.waitingForKey[0].split("").slice(0,oe.waitingForKey[0].length-4).join("")}`;document.getElementById(s).innerText=e.code,document.getElementById("save-settings").style.opacity="1",oe.waitingForKey=!1,document.getElementById("change-key-message").innerText=""}"Space"===e.code&&oe.spaceFunction()}})),document.addEventListener("keydown",(e=>{document.userFeedbackOpen||(e.code===ie[0]&&(e.preventDefault(),se["slide-left"]||ne["tapper-left"]||ve("tapper-left","slide-left","note-leaving-left")),e.code===ie[1]&&(e.preventDefault(),se["slide-a"]||ne["tapper-a"]||(3===de.slides.length?ve("tapper-a","slide-a",Math.random()>.5?"note-leaving-right":"note-leaving-left"):ve("tapper-a","slide-a","note-leaving-left"))),e.code===ie[2]&&(e.preventDefault(),se["slide-b"]||ne["tapper-b"]||ve("tapper-b","slide-b","note-leaving-right")),e.code===ie[3]&&(e.preventDefault(),se["slide-right"]||ne["tapper-right"]||ve("tapper-right","slide-right","note-leaving-right")))})),document.addEventListener("keyup",(e=>{document.userFeedbackOpen||(e.code===ie[0]&&Be("tapper-left"),e.code===ie[1]&&Be("tapper-a"),e.code===ie[2]&&Be("tapper-b"),e.code===ie[3]&&Be("tapper-right"))}));let be=null;function Le(e,t,s=!1,i=0,n=!1){const a=document.createElement("div");a.classList.add("note"),!0===s&&(a.classList.add("note-marked"),a.style.backgroundColor="yellow"),s&&!0!==s&&(a.style.backgroundColor=s);let o=-0;i>0&&(o+=1*i/(oe.songDelay-2e3)*oe.travelLength);let l=!1;if(be&&!be.killed&&!be.isTail&&Math.abs(be.position-o)<2e3/(oe.songDelay-2e3)*.05*(oe.travelLength+0)){if(!(oe.double&&n&&!be.aligned&&de.notesPerSecond>1))return!1;o=be.position,l=!0}a.style.top=`${-1*oe.sliderPos+o}px`;const r={note:a,position:o,slideId:e,target:!1,val:t,isTail:!1,tail:null,seen:!1,aligned:l};if(_.add(r),document.getElementById(e).appendChild(a),be=r,"tutorial"!==oe.songMode)return ee[e]=r,r}const Te={1:5,2:20,3:50,4:100,5:100},we={1:"hit1",2:"hit2",3:"hit3",4:"hit4",5:"hit4"};function ke(){const e=Te[de.notesPerSecond],t=we[de.notesPerSecond];for(let e=0;e<oe.streak;e++){const e=document.createElement("div");e.classList.add(t),document.getElementById("streak-channel").appendChild(e)}const s=document.getElementById("rock-label");oe.streak>e-1&&(document.getElementById("streak-number").innerHTML=oe.streak,document.getElementById("streak-container").classList.remove("hidden"),oe.animations&&document.getElementById("streak-container").classList.add("bulge"),document.getElementById("streak-number").innerHTML=oe.streak,document.getElementById("streak-channel").classList.add("streak-channel-lit"),document.getElementById("streak-meter").classList.add("streak-meter-lit")),oe.streak>199&&(document.getElementById("slides").classList.add("on-fire"),s.innerHTML="ON FIRE!",s.classList.add("rock-label"),oe.onFire=!0,Se=!0,setTimeout((()=>{s.classList.remove("rock-label"),s.innerHTML="",Se=!1}),1300),Se||(s.classList.add("static-rock"),s.innerText=oe.streak))}let Se=!1;function Me(){"tutorial"!==oe.songMode&&he.recordNoteMissed(de.notesPerSecond),"tutorial"!==oe.songMode&&oe.effects&&(q[Math.floor(q.length*Math.random())].play(),oe.streaming||oe.songMode),de.recordNoteMissed(),i("song-label","font-bigA"),"tutorial"!==oe.songMode&&t("song-label",oe.currentSong),document.getElementById("slides").classList.remove("on-fire"),document.getElementById("song-label").classList.remove("on-fire"),oe.onFire&&(oe.puttingOutFire=!0,setTimeout((()=>{oe.puttingOutFire=!1}),6e3)),oe.onFire=!1,document.getElementById("streak-channel").classList.remove("streak-channel-lit"),document.getElementById("streak-meter").classList.remove("streak-meter-lit"),document.getElementById("streak-channel").innerHTML="";const e=document.getElementById("rock-label");Se||"tutorial"===oe.songMode||(e.classList.remove("on-fire"),e.classList.remove("rock-label")),"tutorial"!==oe.songMode&&e.classList.remove("static-rock"),document.getElementById("streak-container").classList.add("hidden"),document.getElementById("streak-container").classList.remove("bulge");const s=oe.streak;s>25&&(Se=!0,"tutorial"!==oe.songMode&&(e.innerHTML=`${s} NOTE <br> STREAK!`,e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),s>50?(e.innerHTML="YOU<br>ROCK!",e.classList.add("rock-label"),setTimeout((()=>{e.classList.remove("rock-label"),e.innerHTML="",Se=!1}),1300)):Se=!1}),1300))),oe.songStreak>ae&&(ae=oe.songStreak),oe.streak=0,oe.songStreak=0,oe.songNotesMissed+=1}function Ce(e,t,s,i){const n=performance.now()-s;if(n<i){const t=1*n/i;document.getElementById(e).style.width=`${Math.ceil(100*t)}%`}else{const e=Math.floor(n/i),s=t[e-1];if(s){let t=1*(n-i*e)/i;t>.9&&(t=1),document.getElementById(s).style.opacity=`${t}`}}n<i*(1+t.length)&&requestAnimationFrame((()=>{Ce(e,t,s,i)}))}function xe(e){const t=document.createElement("div");t.classList.add("note-lighted");const s=document.createElement("div");s.classList.add("note-middle-lighted");const i=document.createElement("div");i.appendChild(t),i.appendChild(s),document.getElementById(`dummy-${e}`).appendChild(i),i.classList.add("flash"),setTimeout((()=>{i.remove()}),1e3)}g().then((e=>{[["toggle-background","animatedBackground","background-title"],["toggle-sustained","sustainedNotes","sustained-title"],["toggle-calibration","autoCalibrating","calibration-title"],["toggle-haptics","hapticsOnHit","haptics-title"],["toggle-animations","animations","animations-title"],["toggle-effects","effects","effects-title"],["toggle-double","double","double-title"]].forEach((t=>{void 0!==e[t[1]]?e[t[1]]?(oe[t[1]]=!0,document.getElementById(`${t[0]}-ball`).classList.remove("toggle-ball-off"),document.getElementById(t[2]).style.opacity="1"):(oe[t[1]]=!1,document.getElementById(`${t[0]}-ball`).classList.add("toggle-ball-off"),document.getElementById(t[2]).style.opacity="0.5","toggle-calibration"===t[0]&&(oe.autoAdjustment=0)):e[t[1]]=oe[t[1]]})),[["select-sustained-frequency","sustainedNotesFrequency"],["select-double-frequency","doubleFrequency"],["algorithm-selector","algorithm"],["speed-selector","songDelay"],["animation-style-selector","animationStyle"]].forEach((t=>{e[t[1]]?(oe[t[1]]=e[t[1]],document.getElementById(t[0]).childNodes.forEach((e=>{e.selected=!1,e.value!==oe[t[1]]&&parseFloat(e.value)!==oe[t[1]]||(e.selected=!0)}))):e[t[1]]=oe[t[1]]})),document.getElementById("toggle-algorithm").innerHTML=oe.algorithm,document.getElementById("toggle-speed").innerHTML={6500:"super slow",5500:"slow",4700:"medium",4e3:"fast",3500:"crazy fast"}[oe.songDelay],document.getElementById("toggle-animation-style").innerHTML={lightUp:"Light up",flyAway:"Fly away",both:"Both"}[oe.animationStyle],oe.targetBounds.top=oe.travelLength-oe.travelLength*w.mobile.targetBounds.top,oe.targetBounds.bottom=oe.travelLength+oe.travelLength*w.mobile.targetBounds.bottom,e.player||(e.player=Math.round(1e6*Math.random())),e.queryInitial?fetch("https://beatburner.com/api/statusQuery.php",{method:"POST",body:JSON.stringify({player:e.player})}).then((t=>{t.json().then((t=>{var s;"success"===t.message?(oe.sendStat=t.data.queryStats,e.queryStats=t.data.queryStats,e.queryInitial=t.data.queryInitial,e.stations=t.data.stations,t.data.messageId>e.lastMessage&&(s=t.data.message,Ae.makeMenusInvisible(),document.getElementById("message-content").innerHTML=s,document.getElementById("message-modal").classList.remove("hidden"),e.lastMessage=t.data.messageId),u().then((()=>{he.setup().then((()=>{ke()})),ue.updateStationInfo(e.stations)}))):u().then((()=>{he.setup().then((()=>{ke()}))}))})).catch((e=>{he.setup().then((()=>{ke()})),console.log(e.message)}))})).catch((e=>{he.setup().then((()=>{ke()})),console.log(e.message)})):(ue.updateStationInfo(e.stations),u().then((()=>{he.setup().then((()=>{ke()}))})))})),document.getElementById("dismiss-message-button").addEventListener("click",(()=>{document.getElementById("message-modal").classList.add("hidden"),Ae.makeMenusVisible()}));const Pe=["slide-left","slide-right","slide-left","slide-right","slide-a","slide-b","slide-left","slide-b","slide-a","slide-right"];let He=0})();